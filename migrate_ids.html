<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∏–≥—Ä–∞—Ü–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #0a0a1a;
            color: white;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #333;
        }
        
        h1 {
            color: #6200ff;
            text-align: center;
        }
        
        .status-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #6200ff;
        }
        
        .log-box {
            background: black;
            color: #00ff88;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            height: 300px;
            overflow-y: auto;
            margin: 15px 0;
            white-space: pre-wrap;
        }
        
        button {
            background: linear-gradient(90deg, #6200ff, #ff00ff);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .warning {
            background: rgba(255, 100, 0, 0.1);
            border-left: 4px solid #ff6400;
            padding: 15px;
            margin: 15px 0;
        }
        
        .success {
            background: rgba(0, 255, 100, 0.1);
            border-left: 4px solid #00ff64;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h1>
        
        <div class="warning">
            <strong>‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!</strong>
            <p>–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∏—Ä—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É ID.</p>
            <p>–°—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–≥–¥–µ ID = –Ω–∏–∫–Ω–µ–π–º) –ø–æ–ª—É—á–∞—Ç –Ω–æ–≤—ã–µ 6-–∑–Ω–∞—á–Ω—ã–µ ID.</p>
            <p>–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–¥–µ–ª–∞–π—Ç–µ –ë–≠–ö–ê–ü –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö!</p>
        </div>
        
        <div class="status-box">
            <h3>–°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏</h3>
            <p id="status-text">–ì–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É...</p>
            <p id="progress-text">–û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞</p>
        </div>
        
        <div>
            <button id="start-btn" onclick="startMigration()">üöÄ –ù–∞—á–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é</button>
            <button id="check-btn" onclick="checkExistingUsers()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</button>
            <button id="test-btn" onclick="testMigration()">üß™ –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)</button>
        </div>
        
        <div class="log-box" id="log-box">
            === –õ–æ–≥ –º–∏–≥—Ä–∞—Ü–∏–∏ ===
            –ñ—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...
        </div>
        
        <div class="status-box" id="results" style="display: none;">
            <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–∏</h3>
            <p id="result-text"></p>
        </div>
    </div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase (—Ç–µ –∂–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
const firebaseConfig = {
    apiKey: "AIzaSyBwhNixWO8dF_drN2hHVYzfTAbMCiT91Gw",
    authDomain: "jojoland-chat.firebasestorage.app",
    databaseURL: "https://jojoland-chat-default-rtdb.firebaseio.com",
    projectId: "jojoland-chat",
    storageBucket: "jojoland-chat.firebasestorage.app",
    messagingSenderId: "602788305122",
    appId: "1:602788305122:web:c03f5b5ef59c85fc9fe6bb"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();

let logBox = document.getElementById('log-box');
let statusText = document.getElementById('status-text');
let progressText = document.getElementById('progress-text');
let resultsDiv = document.getElementById('results');
let resultText = document.getElementById('result-text');

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ 6-–∑–Ω–∞—á–Ω–æ–≥–æ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ ID (–∫–∞–∫ –≤ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ)
function generateRandomId() {
    return Math.floor(100000 + Math.random() * 900000).toString();
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ ID
async function isUserIdUnique(userId) {
    try {
        const snapshot = await database.ref('users/' + userId).once('value');
        return !snapshot.exists();
    } catch (error) {
        log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ ID: ' + error.message);
        return false;
    }
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID
async function generateUniqueId() {
    let attempts = 0;
    const maxAttempts = 20; // –ë–æ–ª—å—à–µ –ø–æ–ø—ã—Ç–æ–∫ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
    
    while (attempts < maxAttempts) {
        const newId = generateRandomId();
        const isUnique = await isUserIdUnique(newId);
        
        if (isUnique) {
            return newId;
        }
        
        attempts++;
        log(`üîÑ –ü–æ–ø—ã—Ç–∫–∞ ${attempts}: ID ${newId} —É–∂–µ –∑–∞–Ω—è—Ç`);
    }
    
    log('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –∑–∞ 20 –ø–æ–ø—ã—Ç–æ–∫');
    return generateRandomId();
}

// –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
function log(message) {
    const timestamp = new Date().toLocaleTimeString();
    logBox.textContent += `\n[${timestamp}] ${message}`;
    logBox.scrollTop = logBox.scrollHeight;
    console.log(message);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
function updateStatus(status, progress = '') {
    statusText.textContent = status;
    if (progress) {
        progressText.textContent = progress;
    }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
async function checkExistingUsers() {
    log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');
    updateStatus('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');
    
    try {
        const snapshot = await database.ref('users').once('value');
        
        if (!snapshot.exists()) {
            log('‚ùå –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö');
            return;
        }
        
        let oldFormatUsers = [];
        let newFormatUsers = [];
        let total = 0;
        
        snapshot.forEach((childSnapshot) => {
            const userId = childSnapshot.key;
            const userData = childSnapshot.val();
            total++;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç ID
            if (/^\d{6}$/.test(userId)) {
                // –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç: 6 —Ü–∏—Ñ—Ä
                newFormatUsers.push({
                    id: userId,
                    nickname: userData.nickname || '–ë–µ–∑ –Ω–∏–∫–∞'
                });
            } else {
                // –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç: –Ω–∏–∫–Ω–µ–π–º –∫–∞–∫ ID
                oldFormatUsers.push({
                    id: userId,
                    nickname: userData.nickname || '–ë–µ–∑ –Ω–∏–∫–∞',
                    data: userData
                });
            }
        });
        
        log(`üìä –í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${total}`);
        log(`‚úÖ –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (6 —Ü–∏—Ñ—Ä): ${newFormatUsers.length}`);
        log(`üîÑ –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (–Ω–∏–∫–Ω–µ–π–º –∫–∞–∫ ID): ${oldFormatUsers.length}`);
        
        if (oldFormatUsers.length > 0) {
            log('\nüë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏:');
            oldFormatUsers.forEach(user => {
                log(`   ‚Ä¢ ${user.nickname} (ID: ${user.id})`);
            });
            
            resultsDiv.style.display = 'block';
            resultText.innerHTML = `
                <strong>–ù–∞–π–¥–µ–Ω–æ ${oldFormatUsers.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏</strong><br>
                ${oldFormatUsers.map(u => `‚Ä¢ ${u.nickname}`).join('<br>')}
            `;
        } else {
            log('üéâ –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–∂–µ –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ! –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.');
            resultsDiv.style.display = 'block';
            resultText.innerHTML = 'üéâ –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É–∂–µ –≤ –Ω–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ! –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.';
        }
        
    } catch (error) {
        log('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ' + error.message);
    }
}

// –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)
async function testMigration() {
    log('üß™ –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏ (–±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)...');
    updateStatus('–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫...');
    
    try {
        const snapshot = await database.ref('users').once('value');
        
        if (!snapshot.exists()) {
            log('‚ùå –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏');
            return;
        }
        
        let migrated = 0;
        let errors = 0;
        let usersToMigrate = [];
        
        // –°–æ–±–∏—Ä–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏
        snapshot.forEach((childSnapshot) => {
            const oldId = childSnapshot.key;
            const userData = childSnapshot.val();
            
            // –ú–∏–≥—Ä–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ —Å—Ç–∞—Ä—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º ID
            if (!/^\d{6}$/.test(oldId)) {
                usersToMigrate.push({ oldId, userData });
            }
        });
        
        log(`üìã –ù–∞–π–¥–µ–Ω–æ ${usersToMigrate.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏`);
        
        // –°–∏–º—É–ª–∏—Ä—É–µ–º –º–∏–≥—Ä–∞—Ü–∏—é (–±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)
        for (let i = 0; i < usersToMigrate.length; i++) {
            const { oldId, userData } = usersToMigrate[i];
            const newId = await generateUniqueId();
            
            log(`\n${i+1}/${usersToMigrate.length}: ${userData.nickname || oldId}`);
            log(`   –°—Ç–∞—Ä—ã–π ID: ${oldId}`);
            log(`   –ù–æ–≤—ã–π ID: ${newId}`);
            log(`   [–¢–ï–°–¢] –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...`);
            
            migrated++;
            
            updateStatus('–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫...', `–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${i+1}/${usersToMigrate.length}`);
        }
        
        log('\nüß™ –¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù');
        log(`üìä –ë—ã–ª–æ –±—ã –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ: ${migrated} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
        log(`‚ùå –û—à–∏–±–æ–∫: ${errors}`);
        log('‚ö†Ô∏è –î–∞–Ω–Ω—ã–µ –ù–ï –±—ã–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã (—Ç–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º)');
        
        resultsDiv.style.display = 'block';
        resultText.innerHTML = `
            <strong>–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ –∑–∞–≤–µ—Ä—à–µ–Ω</strong><br>
            –ë—ã–ª–æ –±—ã –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ: <strong>${migrated}</strong> –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π<br>
            –û—à–∏–±–æ–∫: <strong>${errors}</strong>
        `;
        
    } catch (error) {
        log('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞: ' + error.message);
    }
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏
async function startMigration() {
    if (!confirm('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!\n\n–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é?\n–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!\n\n–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
        return;
    }
    
    log('üöÄ –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...');
    updateStatus('–ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞...');
    
    const startBtn = document.getElementById('start-btn');
    const checkBtn = document.getElementById('check-btn');
    const testBtn = document.getElementById('test-btn');
    
    startBtn.disabled = true;
    checkBtn.disabled = true;
    testBtn.disabled = true;
    
    try {
        const snapshot = await database.ref('users').once('value');
        
        if (!snapshot.exists()) {
            log('‚ùå –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏');
            return;
        }
        
        let migrated = 0;
        let errors = 0;
        let skipped = 0;
        let usersToMigrate = [];
        
        // –°–æ–±–∏—Ä–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏
        snapshot.forEach((childSnapshot) => {
            const oldId = childSnapshot.key;
            const userData = childSnapshot.val();
            
            // –ú–∏–≥—Ä–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–æ —Å—Ç–∞—Ä—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º ID
            if (!/^\d{6}$/.test(oldId)) {
                usersToMigrate.push({ oldId, userData });
            } else {
                skipped++;
            }
        });
        
        log(`üìã –í—Å–µ–≥–æ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏: ${usersToMigrate.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π`);
        log(`‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ (—É–∂–µ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç): ${skipped}`);
        
        if (usersToMigrate.length === 0) {
            log('üéâ –ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏!');
            startBtn.disabled = false;
            checkBtn.disabled = false;
            testBtn.disabled = false;
            return;
        }
        
        // –ú–∏–≥—Ä–∏—Ä—É–µ–º –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        for (let i = 0; i < usersToMigrate.length; i++) {
            const { oldId, userData } = usersToMigrate[i];
            
            log(`\n${i+1}/${usersToMigrate.length}: ${userData.nickname || oldId}`);
            updateStatus('–ú–∏–≥—Ä–∞—Ü–∏—è...', `–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${i+1}/${usersToMigrate.length}`);
            
            try {
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤—ã–π ID
                const newId = await generateUniqueId();
                log(`   –°—Ç–∞—Ä—ã–π ID: ${oldId}`);
                log(`   –ù–æ–≤—ã–π ID: ${newId}`);
                
                // –ö–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
                log(`   –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö...`);
                await database.ref('users/' + newId).set(userData);
                
                // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –∑–∞–ø–∏—Å—å
                log(`   –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∑–∞–ø–∏—Å–∏...`);
                await database.ref('users/' + oldId).remove();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º holiday_points –µ—Å–ª–∏ –µ—Å—Ç—å
                log(`   –ü—Ä–æ–≤–µ—Ä–∫–∞ holiday_points...`);
                const pointsSnapshot = await database.ref('holiday_points/' + oldId).once('value');
                if (pointsSnapshot.exists()) {
                    const pointsData = pointsSnapshot.val();
                    await database.ref('holiday_points/' + newId).set(pointsData);
                    await database.ref('holiday_points/' + oldId).remove();
                    log(`   ‚úì holiday_points –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã`);
                }
                
                migrated++;
                log(`   ‚úÖ –£—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω!`);
                
            } catch (error) {
                errors++;
                log(`   ‚ùå –û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏: ${error.message}`);
            }
            
            // –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
            await new Promise(resolve => setTimeout(resolve, 100));
        }
        
        log('\nüéâ –ú–ò–ì–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê!');
        log(`üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:`);
        log(`   ‚úÖ –£—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ: ${migrated}`);
        log(`   ‚ùå –û—à–∏–±–æ–∫: ${errors}`);
        log(`   ‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ: ${skipped}`);
        
        resultsDiv.style.display = 'block';
        resultText.innerHTML = `
            <strong>–ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!</strong><br><br>
            ‚úÖ –£—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ: <strong>${migrated}</strong> –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π<br>
            ‚ùå –û—à–∏–±–æ–∫: <strong>${errors}</strong><br>
            ‚è≠Ô∏è –ü—Ä–æ–ø—É—â–µ–Ω–æ: <strong>${skipped}</strong><br><br>
            <em>–¢–µ–ø–µ—Ä—å –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–º–µ—é—Ç 6-–∑–Ω–∞—á–Ω—ã–µ —Ü–∏—Ñ—Ä–æ–≤—ã–µ ID</em>
        `;
        
    } catch (error) {
        log('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏: ' + error.message);
    } finally {
        startBtn.disabled = false;
        checkBtn.disabled = false;
        testBtn.disabled = false;
    }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.onload = function() {
    log('üöÄ –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∂–µ–Ω');
    log('IP: play.jojoland.ru');
    log('========================');
    checkExistingUsers();
};
</script>
</body>
</html>
