<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏ JojoLand</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <script src="admin_common.js"></script>
    <script src="admin_auth.js"></script>
    <link rel="stylesheet" href="admin_common.css">
    
    <script src="admin_support.js" defer></script>
    
    <style>
        /* ==================== –°–ü–ï–¶–ò–§–ò–ß–ï–°–ö–ò–ï –°–¢–ò–õ–ò –î–õ–Ø SUPPORT ==================== */
        .support-panel-grid {
            display: grid;
            grid-template-columns: 300px 1fr 400px;
            gap: 20px;
        }
        .ticket-item {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s, border 0.2s;
            border-left: 5px solid transparent;
            display: grid;
            grid-template-columns: 60px 1fr 100px;
            align-items: center;
        }
        .ticket-item:hover { background: rgba(0, 0, 0, 0.4); }
        .ticket-item.selected { background: rgba(98, 0, 255, 0.3); border-left-color: var(--color-accent); }
        .ticket-id { font-weight: bold; font-size: 16px; color: var(--color-primary); }
        .ticket-content h4 { margin: 0 0 4px 0; font-size: 16px; }
        .answer-item.admin { background: rgba(98, 0, 255, 0.2); border-left: 3px solid var(--color-accent); }
        .answer-item.user { background: rgba(0, 0, 0, 0.2); border-left: 3px solid #ccc; }
    </style>
</head>
<body>
    
    <div id="notification-container"></div>
    
    <div id="content" class="admin-container" style="display: none;">
        <div id="adminNavPlaceholder"></div>

        <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <h1 class="admin-section-title" style="margin-bottom: 0;"><i class="fas fa-headset"></i> –ü–∞–Ω–µ–ª—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏</h1>
            <div style="display: flex; gap: 20px;">
                 <div class="admin-badge badge-primary">–í—Å–µ–≥–æ: <span id="totalTicketsCount">0</span></div>
                 <div class="admin-badge badge-warning">–ù–æ–≤—ã—Ö: <span id="newTicketsCount">0</span></div>
            </div>
        </header>

        <div class="support-panel-grid">
            
            <aside class="admin-card" style="padding: 15px;">
                <div style="margin-bottom: 20px; display: flex; align-items: center;">
                    <i class="fas fa-search" style="color: #aaa; margin-right: 8px;"></i>
                    <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ ID, –ò–≥—Ä–æ–∫—É..." style="width: 100%; padding: 8px; border-radius: 5px; border: none; background: #2a2a4d; color: white;">
                </div>

                <div id="mainStatusNav" style="display: flex; flex-direction: column; gap: 8px; margin-bottom: 20px;">
                    <button class="admin-btn admin-btn-secondary active" data-filter="all"><i class="fas fa-list-ul"></i> –í—Å–µ —Ç–∏–∫–µ—Ç—ã</button>
                    <button class="admin-btn admin-btn-secondary" data-filter="new"><i class="fas fa-exclamation-circle"></i> –ù–æ–≤—ã–µ</button>
                    <button class="admin-btn admin-btn-secondary" data-filter="open"><i class="fas fa-folder-open"></i> –í —Ä–∞–±–æ—Ç–µ</button>
                    <button class="admin-btn admin-btn-secondary" data-filter="closed"><i class="fas fa-check-circle"></i> –ó–∞–∫—Ä—ã—Ç—ã–µ</button>
                </div>

                <h3 style="margin: 20px 0 10px 0; color: var(--color-primary); font-size: 16px;"><i class="fas fa-tag"></i> –¢–∏–ø—ã –æ–±—Ä–∞—â–µ–Ω–∏–π</h3>
                <div id="ticketTypesNav" style="display: flex; flex-direction: column; gap: 8px;">
                    </div>
            </aside>

            <main class="admin-card">
                <h2 style="font-size: 20px; margin-bottom: 15px;">–°–ø–∏—Å–æ–∫ –æ–±—Ä–∞—â–µ–Ω–∏–π</h2>
                <div id="ticketsList" style="display: flex; flex-direction: column; gap: 10px;">
                    <div style="text-align: center; padding: 50px; color: #aaa;">
                        <i class="fas fa-spinner fa-spin"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤...
                    </div>
                </div>
            </main>

            <section id="detailsPanel" class="admin-card" style="padding: 20px; display: none;">
                <button id="closeDetailsBtn" class="admin-btn admin-btn-secondary" style="float: right; padding: 5px 10px;"><i class="fas fa-times"></i></button>
                <h2 id="ticketTitle" style="font-size: 24px; margin-bottom: 20px;">–î–µ—Ç–∞–ª–∏ —Ç–∏–∫–µ—Ç–∞ #<span id="ticketIdDisplay">0000</span></h2>
                
                <div class="ticket-info" style="font-size: 14px;">
                    <p style="margin-bottom: 5px;"><strong><i class="fas fa-user"></i> –ò–≥—Ä–æ–∫:</strong> <span id="playerUsername"></span> (<span id="playerUid"></span>)</p>
                    <p style="margin-bottom: 5px;"><strong><i class="fas fa-tag"></i> –ü—Ä–∏—á–∏–Ω–∞:</strong> <span id="ticketReason"></span></p>
                    <p><strong><i class="fas fa-calendar-alt"></i> –°–æ–∑–¥–∞–Ω:</strong> <span id="ticketDate"></span></p>
                </div>
                
                <h3 style="font-size: 18px; margin: 20px 0 10px 0;"><i class="fas fa-file-alt"></i> –û–ø–∏—Å–∞–Ω–∏–µ</h3>
                <p id="ticketDescription" style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; white-space: pre-wrap; font-size: 14px;"></p>

                <h3 style="font-size: 18px; margin: 20px 0 10px 0;"><i class="fas fa-link"></i> –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞</h3>
                <div id="ticketProof" style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; font-size: 14px;">–ù–µ—Ç</div>
                
                <div style="display: flex; gap: 10px; align-items: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                    <div style="font-size: 14px;">–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: <span id="currentStatus" class="admin-badge"></span></div>
                    
                    <select id="statusSelect" style="padding: 8px; border-radius: 5px; border: 1px solid #333; background: #222; color: white;">
                        <option value="new">–ù–æ–≤—ã–π</option>
                        <option value="open">–í —Ä–∞–±–æ—Ç–µ</option>
                        <option value="closed">–ó–∞–∫—Ä—ã—Ç</option>
                    </select>
                    <button id="saveStatusBtn" class="admin-btn admin-btn-primary" style="padding: 8px 15px;"><i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                </div>

                <div style="margin-top: 20px;">
                    <h3 style="font-size: 18px; margin-bottom: 10px;"><i class="fas fa-comments"></i> –ü–µ—Ä–µ–ø–∏—Å–∫–∞</h3>
                    <div id="answersList" style="max-height: 250px; overflow-y: auto; padding-right: 10px;">
                        </div>

                    <div style="margin-top: 15px; display: flex; flex-direction: column; gap: 10px;">
                        <textarea id="adminAnswerText" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–≤–æ–π –æ—Ç–≤–µ—Ç –∑–¥–µ—Å—å... (Ctrl+Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏)" style="width: 100%; height: 80px; padding: 10px; border-radius: 8px; border: 1px solid #333; background: #111; color: white; resize: vertical;"></textarea>
                        <button id="sendAnswerBtn" class="admin-btn admin-btn-primary"><i class="fas fa-reply"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
                    </div>
                </div>

            </section>
        </div>
    </div>
    
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        document.addEventListener('DOMContentLoaded', () => {
            checkAdminAuth().then(authStatus => {
                if (authStatus.success) {
                    document.getElementById('content').style.display = 'block';
                    fetch('admin_nav.html').then(r => r.text()).then(html => {
                        document.getElementById('adminNavPlaceholder').innerHTML = html;
                        initSupportPanel(); // –ó–∞–ø—É—Å–∫ –ª–æ–≥–∏–∫–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
                    });
                } else {
                    redirectToLogin();
                }
            });
        });
    </script>
</body>
</html>
