<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏ JojoLand</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ–±—â–∏–π —Ñ–∞–π–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <script src="admin_auth.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a2a, #1a1a4a, #0a0a2a);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .admin-nav {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255,0,255,0.3);
        }
        
        .admin-nav a {
            padding: 10px 20px;
            background: rgba(0,100,255,0.2);
            color: #6ab7ff;
            text-decoration: none;
            border-radius: 25px;
            border: 1px solid rgba(0,100,255,0.4);
            transition: 0.3s;
            font-weight: bold;
        }
        
        .admin-nav a:hover {
            background: rgba(0,100,255,0.4);
            transform: translateY(-2px);
        }
        
        /* –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ */
        .admin-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 25px;
        }
        
        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .sidebar {
            background: rgba(0,0,0,0.6);
            border-radius: 25px;
            padding: 25px;
            border: 2px solid #0066ff;
            height: fit-content;
            position: sticky;
            top: 20px;
        }
        
        .admin-info {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .admin-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 3px solid #0066ff;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, #0066ff, #00ccff);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #00ff00;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #aaa;
        }
        
        /* –§–∏–ª—å—Ç—Ä—ã */
        .filter-section {
            margin-bottom: 20px;
        }
        
        .filter-section h4 {
            color: #6ab7ff;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .filter-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-btn {
            padding: 10px 15px;
            background: rgba(255,255,255,0.05);
            border: none;
            border-radius: 10px;
            color: white;
            text-align: left;
            cursor: pointer;
            transition: 0.3s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background: rgba(0,100,255,0.3);
            border-left: 4px solid #0066ff;
        }
        
        .filter-count {
            margin-left: auto;
            background: rgba(255,255,255,0.1);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å */
        .main-panel {
            background: rgba(0,0,0,0.6);
            border-radius: 25px;
            padding: 25px;
            border: 2px solid #0066ff;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            flex: 1;
            max-width: 400px;
        }
        
        .search-box input {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
        }
        
        .search-box button {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(90deg, #0066ff, #0099ff);
            color: white;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* –°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤ */
        .tickets-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .ticket-item {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: 0.3s;
            border: 2px solid transparent;
            position: relative;
        }
        
        .ticket-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-2px);
            border-color: rgba(0,100,255,0.5);
        }
        
        .ticket-item.selected {
            background: rgba(0,100,255,0.2);
            border-color: #0066ff;
        }
        
        .ticket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .ticket-id {
            font-weight: bold;
            font-size: 18px;
            color: #6ab7ff;
        }
        
        .ticket-type {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .type-complaint { background: rgba(255,153,0,0.2); color: #ff9900; }
        .type-appeal { background: rgba(0,153,255,0.2); color: #0099ff; }
        .type-support { background: rgba(0,204,153,0.2); color: #00cc99; }
        
        .ticket-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-new { background: rgba(255,255,0,0.2); color: #ffff00; }
        .status-read { background: rgba(0,255,0,0.2); color: #00ff00; }
        .status-answered { background: rgba(0,150,255,0.2); color: #0096ff; }
        .status-closed { background: rgba(255,0,0,0.2); color: #ff0000; }
        
        .ticket-user {
            color: #aaa;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .ticket-preview {
            color: #ccccff;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .ticket-time {
            font-size: 12px;
            color: #888;
            text-align: right;
        }
        
        /* –¢–∞–π–º–µ—Ä —É–¥–∞–ª–µ–Ω–∏—è */
        .ticket-timer {
            color: #ff9900;
            font-size: 11px;
            font-weight: bold;
            padding: 2px 8px;
            background: rgba(255,153,0,0.1);
            border-radius: 10px;
            display: inline-block;
            margin-left: 10px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* –î–µ—Ç–∞–ª–∏ —Ç–∏–∫–µ—Ç–∞ */
        .ticket-details {
            display: none;
            animation: slideIn 0.3s ease;
        }
        
        .ticket-details.active {
            display: block;
        }
        
        .ticket-content {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .info-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
        }
        
        .info-label {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 16px;
            color: white;
            word-break: break-word;
        }
        
        .message-box {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 4px solid #0066ff;
        }
        
        .message-box h4 {
            color: #6ab7ff;
            margin-bottom: 10px;
        }
        
        .message-text {
            color: white;
            line-height: 1.6;
            white-space: pre-wrap;
        }
        
        /* –§–æ—Ä–º–∞ –æ—Ç–≤–µ—Ç–∞ */
        .response-form {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid rgba(255,255,255,0.1);
        }
        
        .response-form h3 {
            color: #00ff00;
            margin-bottom: 15px;
        }
        
        .response-textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: none;
            border-radius: 15px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
            font-family: inherit;
            margin-bottom: 15px;
            resize: vertical;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-send {
            background: linear-gradient(90deg, #00cc00, #00ff00);
            color: #003300;
        }
        
        .btn-close {
            background: linear-gradient(90deg, #ff6600, #ff9900);
            color: white;
        }
        
        .btn-delete {
            background: linear-gradient(90deg, #ff0000, #ff3333);
            color: white;
        }
        
        .btn-skip {
            background: rgba(255,255,255,0.1);
            color: white;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        /* –ñ—É—Ä–Ω–∞–ª –¥–µ–π—Å—Ç–≤–∏–π */
        .action-log {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
        }
        
        .log-item {
            padding: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 14px;
        }
        
        .log-time {
            color: #aaa;
            font-size: 12px;
            margin-right: 10px;
        }
        
        .log-action {
            color: white;
        }
        
        .log-admin {
            color: #6ab7ff;
            font-weight: bold;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤—Ö–æ–¥–∞ */
        .login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        
        .login-modal.active {
            display: flex;
        }
        
        .login-box {
            background: linear-gradient(135deg, #0a0a2a, #1a1a4a);
            padding: 40px;
            border-radius: 25px;
            border: 3px solid #0066ff;
            width: 90%;
            max-width: 400px;
            text-align: center;
            animation: modalAppear 0.3s ease;
        }
        
        .login-logo {
            font-size: 60px;
            margin-bottom: 20px;
            color: #0066ff;
        }
        
        .login-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: white;
        }
        
        .login-subtitle {
            color: #aaa;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .password-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid rgba(0, 100, 255, 0.5);
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 18px;
            text-align: center;
            letter-spacing: 2px;
            margin-bottom: 20px;
            transition: 0.3s;
        }
        
        .password-input:focus {
            outline: none;
            border-color: #0066ff;
            box-shadow: 0 0 15px rgba(0, 100, 255, 0.5);
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(90deg, #0066ff, #0099ff);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 100, 255, 0.5);
        }
        
        .error-message {
            color: #ff3333;
            margin-top: 10px;
            font-size: 14px;
            min-height: 20px;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* –ü–æ–ª–æ—Å—ã –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
        .tickets-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .tickets-list::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        
        .tickets-list::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #0066ff, #0099ff);
            border-radius: 10px;
        }
        
        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 1024px) {
            .admin-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
            }
        }
        
        @media (max-width: 768px) {
            .panel-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .search-box {
                max-width: none;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞ -->
    <div class="login-modal active" id="loginModal">
        <div class="login-box">
            <div class="login-logo">üõ°Ô∏è</div>
            <h2 class="login-title">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å JojoLand</h2>
            <p class="login-subtitle">–î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</p>
            
            <input type="password" 
                   class="password-input" 
                   id="passwordInput"
                   placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å"
                   onkeypress="handlePasswordEnter(event)">
            
            <button class="login-btn" onclick="checkPassword()">
                üîê –í–æ–π—Ç–∏ –≤ –ø–∞–Ω–µ–ª—å
            </button>
            
            <div class="error-message" id="errorMessage"></div>
            
            <p style="color: #666; font-size: 12px; margin-top: 30px;">
                üîí –í–Ω–∏–º–∞–Ω–∏–µ: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –Ω–∞ 30 —Å–µ–∫—É–Ω–¥
            </p>
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç (—Å–∫—Ä—ã—Ç –¥–æ –≤—Ö–æ–¥–∞) -->
    <div id="adminContent" style="display: none;">
        <div class="container">
            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
            <div class="admin-nav">
                <a href="index.html">üè† –ì–ª–∞–≤–Ω–∞—è</a>
                <a href="admin_support.html" style="background: rgba(0,100,255,0.4);">üõ°Ô∏è –ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
                <a href="admin_users.html">üë• –ò–≥—Ä–æ–∫–∏</a>
                <a href="admin_stats.html">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                <a href="admin_logs.html">üìã –õ–æ–≥–∏</a>
                <button onclick="logout()" style="margin-left: auto; padding: 10px 20px; background: rgba(255,0,0,0.2); color: #ff6666; border: 1px solid #ff6666; border-radius: 25px; cursor: pointer;">
                    üö™ –í—ã–π—Ç–∏
                </button>
            </div>
            
            <!-- –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
            <div class="admin-container">
                <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
                <div class="sidebar">
                    <div class="admin-info">
                        <div class="admin-avatar">üëë</div>
                        <h3 id="adminName">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</h3>
                        <p style="color: #aaa; font-size: 14px;" id="adminRole">üëë –°—É–ø–µ—Ä–∞–¥–º–∏–Ω</p>
                        <p style="color: #666; font-size: 12px; margin-top: 5px;" id="lastLogin"></p>
                    </div>
                    
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="newTickets">0</div>
                            <div class="stat-label">–ù–æ–≤—ã—Ö</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalTickets">0</div>
                            <div class="stat-label">–í—Å–µ–≥–æ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="todayTickets">0</div>
                            <div class="stat-label">–°–µ–≥–æ–¥–Ω—è</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="responseTime">0—á</div>
                            <div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞</div>
                        </div>
                    </div>
                    
                    <!-- –§–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–∏–ø—É -->
                    <div class="filter-section">
                        <h4>üìÅ –¢–∏–ø –æ–±—Ä–∞—â–µ–Ω–∏—è</h4>
                        <div class="filter-buttons">
                            <button class="filter-btn active" onclick="filterTickets('all')">
                                üìã –í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è
                                <span class="filter-count" id="countAll">0</span>
                            </button>
                            <button class="filter-btn" onclick="filterTickets('complaint')">
                                ‚ö†Ô∏è –ñ–∞–ª–æ–±—ã
                                <span class="filter-count" id="countComplaints">0</span>
                            </button>
                            <button class="filter-btn" onclick="filterTickets('appeal')">
                                ‚öñÔ∏è –ê–ø–µ–ª–ª—è—Ü–∏–∏
                                <span class="filter-count" id="countAppeals">0</span>
                            </button>
                            <button class="filter-btn" onclick="filterTickets('support')">
                                üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞
                                <span class="filter-count" id="countSupport">0</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- –§–∏–ª—å—Ç—Ä—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É -->
                    <div class="filter-section">
                        <h4>üìä –°—Ç–∞—Ç—É—Å</h4>
                        <div class="filter-buttons">
                            <button class="filter-btn" onclick="filterByStatus('new')">
                                üÜï –ù–æ–≤—ã–µ
                                <span class="filter-count" id="countNew">0</span>
                            </button>
                            <button class="filter-btn" onclick="filterByStatus('read')">
                                üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ
                                <span class="filter-count" id="countRead">0</span>
                            </button>
                            <button class="filter-btn" onclick="filterByStatus('answered')">
                                üì® –° –æ—Ç–≤–µ—Ç–æ–º
                                <span class="filter-count" id="countAnswered">0</span>
                            </button>
                            <button class="filter-btn" onclick="filterByStatus('closed')">
                                ‚úÖ –ó–∞–∫—Ä—ã—Ç—ã–µ
                                <span class="filter-count" id="countClosed">0</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                    <div class="filter-section">
                        <h4>‚ö° –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h4>
                        <div class="filter-buttons">
                            <button class="filter-btn" onclick="markAllAsRead()">
                                ‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
                            </button>
                            <button class="filter-btn" onclick="exportAllTickets()">
                                üì• –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π
                            </button>
                            <button class="filter-btn" onclick="showStats()">
                                üìä –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- –û—Å–Ω–æ–≤–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
                <div class="main-panel">
                    <div class="panel-header">
                        <h2>üõ°Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è–º–∏</h2>
                        <div class="search-box">
                            <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ ID, –Ω–∏–∫—É –∏–ª–∏ —Ç–µ–∫—Å—Ç—É...">
                            <button onclick="searchTickets()">üîç</button>
                        </div>
                    </div>
                    
                    <!-- –°–ø–∏—Å–æ–∫ —Ç–∏–∫–µ—Ç–æ–≤ -->
                    <div class="tickets-list" id="ticketsList">
                        <div style="text-align: center; padding: 50px; color: #aaa;">
                            –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π...
                        </div>
                    </div>
                    
                    <!-- –î–µ—Ç–∞–ª–∏ —Ç–∏–∫–µ—Ç–∞ -->
                    <div class="ticket-details" id="ticketDetails">
                        <div class="ticket-content">
                            <div class="ticket-header">
                                <h3 id="detailTicketId">TICKET-ID</h3>
                                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                    <span id="detailType" class="ticket-type">–¢–∏–ø</span>
                                    <span id="detailStatus" class="ticket-status">–°—Ç–∞—Ç—É—Å</span>
                                </div>
                            </div>
                            
                            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∏–∫–µ—Ç–µ -->
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-label">üë§ –ò–≥—Ä–æ–∫</div>
                                    <div class="info-value" id="detailUser">-</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">üÜî User ID</div>
                                    <div class="info-value" id="detailUserId">-</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">üìÖ –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</div>
                                    <div class="info-value" id="detailDate">-</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">‚è±Ô∏è –í—Ä–µ–º—è –≤ —Ä–∞–±–æ—Ç–µ</div>
                                    <div class="info-value" id="detailTimeOpen">-</div>
                                </div>
                            </div>
                            
                            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                            <div id="extraInfo"></div>
                            
                            <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ -->
                            <div class="message-box">
                                <h4>üìù –°–æ–æ–±—â–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞:</h4>
                                <div class="message-text" id="detailMessage">-</div>
                            </div>
                            
                            <!-- –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ -->
                            <div class="message-box" id="proofSection" style="display: none;">
                                <h4>üìé –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:</h4>
                                <div class="message-text" id="detailProof">-</div>
                            </div>
                            
                            <!-- –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–≤–µ—Ç–æ–≤ -->
                            <div class="message-box" id="answersSection" style="display: none;">
                                <h4>üì® –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–≤–µ—Ç–æ–≤:</h4>
                                <div id="answersList"></div>
                            </div>
                            
                            <!-- –§–æ—Ä–º–∞ –æ—Ç–≤–µ—Ç–∞ -->
                            <div class="response-form">
                                <h3>üì§ –û—Ç–≤–µ—Ç–∏—Ç—å –∏–≥—Ä–æ–∫—É</h3>
                                <textarea class="response-textarea" id="responseText" 
                                          placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç..."></textarea>
                                
                                <div class="action-buttons">
                                    <button class="action-btn btn-send" onclick="sendResponse()">
                                        üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç
                                    </button>
                                    <button class="action-btn btn-close" onclick="closeTicket()">
                                        ‚úÖ –ó–∞–∫—Ä—ã—Ç—å —Ç–∏–∫–µ—Ç
                                    </button>
                                    <button class="action-btn btn-delete" onclick="deleteTicket()">
                                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Ç–∏–∫–µ—Ç
                                    </button>
                                    <button class="action-btn btn-skip" onclick="skipTicket()">
                                        ‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
                                    </button>
                                </div>
                            </div>
                            
                            <!-- –ñ—É—Ä–Ω–∞–ª –¥–µ–π—Å—Ç–≤–∏–π -->
                            <div class="action-log" id="actionLog">
                                <h4>üìã –ñ—É—Ä–Ω–∞–ª –¥–µ–π—Å—Ç–≤–∏–π:</h4>
                                <div id="logList"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== –ù–ê–°–¢–†–û–ô–ö–ò ====================
        const ADMIN_PASSWORD = "Jojoland2024!"; // ‚Üê –ò–ó–ú–ï–ù–ò–¢–ï –≠–¢–û–¢ –ü–ê–†–û–õ–¨!
        const BLOCK_TIME = 30; // —Å–µ–∫—É–Ω–¥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–µ
        const MAX_ATTEMPTS = 3; // –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
        const AUTO_DELETE_DELAY = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
        
        // ==================== FIREBASE –ö–û–ù–§–ò–ì ====================
        const firebaseConfig = {
            apiKey: "AIzaSyBwhNixWO8dF_drN2hHVYzfTAbMCiT91Gw",
            authDomain: "jojoland-chat.firebaseapp.com",
            databaseURL: "https://jojoland-chat-default-rtdb.firebaseio.com",
            projectId: "jojoland-chat",
            storageBucket: "jojoland-chat.firebasestorage.app",
            messagingSenderId: "602788305122",
            appId: "1:602788305122:web:c03f5b5ef59c85fc9fe6bb"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // ==================== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let currentAdmin = {
            name: "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä",
            ip: "unknown"
        };
        let currentFilter = 'all';
        let currentStatusFilter = null;
        let allTickets = [];
        let filteredTickets = [];
        let selectedTicketId = null;
        let selectedTicketData = null;
        let failedAttempts = 0;
        let isBlocked = false;
        let blockUntil = 0;
        
        // ==================== –ü–†–û–í–ï–†–ö–ê –ü–ê–†–û–õ–Ø ====================
        function checkPassword() {
            if (isBlocked) {
                const timeLeft = Math.ceil((blockUntil - Date.now()) / 1000);
                showError(`üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ ${timeLeft} —Å–µ–∫—É–Ω–¥`);
                return;
            }
            
            const password = document.getElementById('passwordInput').value;
            const errorElement = document.getElementById('errorMessage');
            
            if (!password) {
                showError('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
                return;
            }
            
            if (password === ADMIN_PASSWORD) {
                loginSuccess();
            } else {
                failedAttempts++;
                
                if (failedAttempts >= MAX_ATTEMPTS) {
                    isBlocked = true;
                    blockUntil = Date.now() + (BLOCK_TIME * 1000);
                    
                    setTimeout(() => {
                        isBlocked = false;
                        failedAttempts = 0;
                        document.getElementById('passwordInput').disabled = false;
                        document.getElementById('passwordInput').placeholder = "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å";
                        errorElement.textContent = '';
                    }, BLOCK_TIME * 1000);
                    
                    document.getElementById('passwordInput').disabled = true;
                    document.getElementById('passwordInput').placeholder = `–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ ${BLOCK_TIME} —Å–µ–∫—É–Ω–¥`;
                    
                    showError(`‚ùå –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫! –ü–æ–¥–æ–∂–¥–∏—Ç–µ ${BLOCK_TIME} —Å–µ–∫—É–Ω–¥`);
                } else {
                    showError(`‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å! –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: ${MAX_ATTEMPTS - failedAttempts}`);
                    document.getElementById('passwordInput').value = '';
                    document.getElementById('passwordInput').focus();
                }
            }
        }
        
        function handlePasswordEnter(event) {
            if (event.key === 'Enter') {
                checkPassword();
            }
        }
        
        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            
            setTimeout(() => {
                errorElement.textContent = '';
            }, 3000);
        }
        
        async function loginSuccess() {
            const adminIP = await getIP();
            currentAdmin.ip = adminIP;
            
            const loginTime = new Date();
            localStorage.setItem('adminLastLogin', loginTime.toISOString());
            localStorage.setItem('adminSession', 'active');
            
            document.getElementById('loginModal').classList.remove('active');
            document.getElementById('adminContent').style.display = 'block';
            
            const savedName = localStorage.getItem('adminName');
            if (savedName) {
                document.getElementById('adminName').textContent = savedName;
                currentAdmin.name = savedName;
            }
            
            const lastLogin = document.getElementById('lastLogin');
            lastLogin.textContent = `–í—Ö–æ–¥: ${loginTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
            
            initAdminPanel();
            logAdminAction('login', '–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å');
            
            setTimeout(() => {
                document.getElementById('searchInput').focus();
            }, 500);
        }
        
        // ==================== –í–´–•–û–î ====================
        function logout() {
            if (confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏?')) {
                logAdminAction('logout', '–í—ã—Ö–æ–¥ –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å');
                localStorage.removeItem('adminSession');
                
                document.getElementById('adminContent').style.display = 'none';
                document.getElementById('loginModal').classList.add('active');
                
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
                
                failedAttempts = 0;
                isBlocked = false;
                selectedTicketId = null;
                selectedTicketData = null;
                document.getElementById('ticketDetails').classList.remove('active');
            }
        }
        
        // ==================== –õ–û–ì–ò–†–û–í–ê–ù–ò–ï ====================
        async function logAdminAction(action, description) {
            try {
                await database.ref('admin_actions').push({
                    action: action,
                    description: description,
                    adminName: currentAdmin.name,
                    adminIP: currentAdmin.ip,
                    timestamp: Date.now()
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
            }
        }
        
        async function getIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'unknown';
            }
        }
        
        // ==================== –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ï –£–î–ê–õ–ï–ù–ò–ï ====================
        async function setupAutoDelete(ticketId, ticketData) {
            if (ticketData.status === 'answered' || ticketData.status === 'closed') {
                setTimeout(async () => {
                    try {
                        await autoDeleteTicket(ticketId, ticketData);
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                    }
                }, AUTO_DELETE_DELAY);
            }
        }
        
        async function autoDeleteTicket(ticketId, ticketData) {
            try {
                if (!ticketData.adminAnswer) {
                    console.log(`‚ùå –¢–∏–∫–µ—Ç ${ticketId} –Ω–µ —É–¥–∞–ª–µ–Ω - –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞ –∞–¥–º–∏–Ω–∞`);
                    return;
                }

                const answerTime = ticketData.answerTime || ticketData.timestamp;
                const timeSinceAnswer = Date.now() - answerTime;
                
                if (timeSinceAnswer < AUTO_DELETE_DELAY) {
                    console.log(`‚è≥ –¢–∏–∫–µ—Ç ${ticketId} –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤ –∫ —É–¥–∞–ª–µ–Ω–∏—é`);
                    return;
                }

                await logAction('auto_delete', `–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏–ª –æ–±—Ä–∞—â–µ–Ω–∏–µ ${ticketData.ticketId}`);

                await database.ref(`support_tickets/${ticketId}`).remove();
                await database.ref(`ticket_answers/${ticketId}`).remove();
                await database.ref(`ticket_logs/${ticketId}`).remove();

                console.log(`‚úÖ –¢–∏–∫–µ—Ç ${ticketId} –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–µ–Ω`);

                allTickets = allTickets.filter(t => t.id !== ticketId);
                
                if (selectedTicketId === ticketId) {
                    selectedTicketId = null;
                    selectedTicketData = null;
                    document.getElementById('ticketDetails').classList.remove('active');
                }
                
                updateTicketsList();
                updateStats();

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è —Ç–∏–∫–µ—Ç–∞:', error);
            }
        }
        
        // ==================== –ü–†–û–í–ï–†–ö–ê –°–¢–ê–†–´–• –¢–ò–ö–ï–¢–û–í ====================
        async function checkOldTickets() {
            try {
                const now = Date.now();
                const deleteTime = now - AUTO_DELETE_DELAY;
                
                const ticketsToDelete = allTickets.filter(ticket => {
                    const answerTime = ticket.answerTime || ticket.closedTime || ticket.timestamp;
                    return ticket.adminAnswer && 
                           (ticket.status === 'answered' || ticket.status === 'closed') &&
                           answerTime < deleteTime;
                });

                for (const ticket of ticketsToDelete) {
                    await autoDeleteTicket(ticket.id, ticket);
                }

                if (ticketsToDelete.length > 0) {
                    console.log(`üóëÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–µ–Ω–æ ${ticketsToDelete.length} —Å—Ç–∞—Ä—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤`);
                }

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ä—ã—Ö —Ç–∏–∫–µ—Ç–æ–≤:', error);
            }
        }
        
        // ==================== –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• ====================
        async function loadAllTickets() {
            try {
                const snapshot = await database.ref('support_tickets')
                    .orderByChild('timestamp')
                    .once('value');
                
                allTickets = [];
                
                if (!snapshot.exists()) {
                    updateTicketsList();
                    updateStats();
                    return;
                }
                
                snapshot.forEach(childSnapshot => {
                    const ticket = {
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    };
                    allTickets.unshift(ticket);
                    
                    checkAndDeleteOldTicket(ticket);
                });
                
                updateTicketsList();
                updateStats();
                
                const newTicket = allTickets.find(t => t.status === 'new');
                if (newTicket) {
                    selectTicket(newTicket.id);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π:', error);
                showMessage('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏—è', 'error');
            }
        }
        
        async function checkAndDeleteOldTicket(ticket) {
            if (ticket.adminAnswer && (ticket.status === 'answered' || ticket.status === 'closed')) {
                const answerTime = ticket.answerTime || ticket.closedTime || ticket.timestamp;
                const timeSinceAnswer = Date.now() - answerTime;
                
                if (timeSinceAnswer > AUTO_DELETE_DELAY) {
                    await autoDeleteTicket(ticket.id, ticket);
                } else {
                    const timeLeft = AUTO_DELETE_DELAY - timeSinceAnswer;
                    setTimeout(async () => {
                        await autoDeleteTicket(ticket.id, ticket);
                    }, timeLeft);
                }
            }
        }
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        function initAdminPanel() {
            loadAllTickets();
            setInterval(updateStats, 30000);
            setInterval(checkOldTickets, 60000);
            
            window.addEventListener('beforeunload', () => {
                localStorage.setItem('adminSessionActive', 'true');
            });
            
            setTimeout(() => {
                if (allTickets.length === 0) {
                    alert('üí° –°–æ–≤–µ—Ç: –î–ª—è —Ç–µ—Å—Ç–∞ —Å–æ–∑–¥–∞–π—Ç–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ —Å –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–∞–π—Ç–∞, –∑–∞—Ç–µ–º –æ–±–Ω–æ–≤–∏—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                }
            }, 2000);
        }
        
        // ==================== –§–ò–õ–¨–¢–†–ê–¶–ò–Ø ====================
        function filterTickets(type) {
            currentFilter = type;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            updateTicketsList();
        }
        
        function filterByStatus(status) {
            currentStatusFilter = status;
            document.querySelectorAll('.filter-section:nth-child(3) .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            updateTicketsList();
        }
        
        function updateTicketsList() {
            filteredTickets = allTickets.filter(ticket => {
                if (currentFilter !== 'all' && ticket.type !== currentFilter) {
                    return false;
                }
                if (currentStatusFilter && ticket.status !== currentStatusFilter) {
                    return false;
                }
                return true;
            });
            
            updateFilterCounts();
            const ticketsList = document.getElementById('ticketsList');
            
            if (filteredTickets.length === 0) {
                ticketsList.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #aaa;">
                        üì≠ –ù–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π –ø–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            filteredTickets.forEach(ticket => {
                const date = new Date(ticket.timestamp);
                const dateStr = date.toLocaleDateString() + ' ' + 
                               date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                const typeText = ticket.type === 'complaint' ? '–ñ–∞–ª–æ–±–∞' : 
                                ticket.type === 'appeal' ? '–ê–ø–µ–ª–ª—è—Ü–∏—è' : '–ü–æ–¥–¥–µ—Ä–∂–∫–∞';
                
                const typeClass = ticket.type === 'complaint' ? 'type-complaint' : 
                                 ticket.type === 'appeal' ? 'type-appeal' : 'type-support';
                
                const statusText = ticket.status === 'new' ? '–ù–æ–≤–æ–µ' : 
                                  ticket.status === 'read' ? '–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ' : 
                                  ticket.status === 'answered' ? '–° –æ—Ç–≤–µ—Ç–æ–º' : '–ó–∞–∫—Ä—ã—Ç–æ';
                
                const statusClass = ticket.status === 'new' ? 'status-new' : 
                                   ticket.status === 'read' ? 'status-read' : 
                                   ticket.status === 'answered' ? 'status-answered' : 'status-closed';
                
                const isSelected = ticket.id === selectedTicketId ? 'selected' : '';
                
                // –¢–∞–π–º–µ—Ä —É–¥–∞–ª–µ–Ω–∏—è
                let timerHtml = '';
                if (ticket.adminAnswer && (ticket.status === 'answered' || ticket.status === 'closed')) {
                    const answerTime = ticket.answerTime || ticket.timestamp;
                    const timeLeft = AUTO_DELETE_DELAY - (Date.now() - answerTime);
                    
                    if (timeLeft > 0) {
                        const minutes = Math.floor(timeLeft / 60000);
                        const seconds = Math.floor((timeLeft % 60000) / 1000);
                        timerHtml = `<span class="ticket-timer">üóëÔ∏è ${minutes}:${seconds.toString().padStart(2, '0')}</span>`;
                    }
                }
                
                html += `
                    <div class="ticket-item ${isSelected}" onclick="selectTicket('${ticket.id}')">
                        <div class="ticket-header">
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <span class="ticket-id">${ticket.ticketId || ticket.id}</span>
                                <span class="ticket-type ${typeClass}">${typeText}</span>
                                ${timerHtml}
                            </div>
                            <span class="ticket-status ${statusClass}">${statusText}</span>
                        </div>
                        <div class="ticket-user">
                            üë§ ${ticket.userNickname || ticket.username || '–ò–≥—Ä–æ–∫'}
                        </div>
                        <div class="ticket-preview">
                            ${truncateText(ticket.description || ticket.reason || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è', 120)}
                        </div>
                        <div class="ticket-time">${dateStr}</div>
                    </div>
                `;
            });
            
            ticketsList.innerHTML = html;
        }
        
        function updateFilterCounts() {
            const counts = {
                all: allTickets.length,
                complaint: allTickets.filter(t => t.type === 'complaint').length,
                appeal: allTickets.filter(t => t.type === 'appeal').length,
                support: allTickets.filter(t => t.type === 'support').length,
                new: allTickets.filter(t => t.status === 'new').length,
                read: allTickets.filter(t => t.status === 'read').length,
                answered: allTickets.filter(t => t.status === 'answered').length,
                closed: allTickets.filter(t => t.status === 'closed').length
            };
            
            document.getElementById('countAll').textContent = counts.all;
            document.getElementById('countComplaints').textContent = counts.complaint;
            document.getElementById('countAppeals').textContent = counts.appeal;
            document.getElementById('countSupport').textContent = counts.support;
            document.getElementById('countNew').textContent = counts.new;
            document.getElementById('countRead').textContent = counts.read;
            document.getElementById('countAnswered').textContent = counts.answered;
            document.getElementById('countClosed').textContent = counts.closed;
            
            document.getElementById('newTickets').textContent = counts.new;
            document.getElementById('totalTickets').textContent = counts.all;
            
            const today = new Date().setHours(0,0,0,0);
            const todayCount = allTickets.filter(t => new Date(t.timestamp) >= today).length;
            document.getElementById('todayTickets').textContent = todayCount;
        }
        
        // ==================== –í–´–ë–û–† –¢–ò–ö–ï–¢–ê ====================
        async function selectTicket(ticketId) {
            selectedTicketId = ticketId;
            selectedTicketData = allTickets.find(t => t.id === ticketId);
            
            if (!selectedTicketData) return;
            
            updateTicketsList();
            
            if (selectedTicketData.status === 'new') {
                await database.ref(`support_tickets/${ticketId}/status`).set('read');
                selectedTicketData.status = 'read';
                updateStats();
                logAction('read', `–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–ª –æ–±—Ä–∞—â–µ–Ω–∏–µ ${selectedTicketData.ticketId}`);
            }
            
            showTicketDetails();
            loadTicketAnswers(ticketId);
            loadActionLog(ticketId);
        }
        
        function showTicketDetails() {
            const details = document.getElementById('ticketDetails');
            details.classList.add('active');
            
            const ticket = selectedTicketData;
            const date = new Date(ticket.timestamp);
            const dateStr = date.toLocaleDateString() + ' ' + 
                           date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            document.getElementById('detailTicketId').textContent = ticket.ticketId || ticket.id;
            document.getElementById('detailUser').textContent = ticket.userNickname || ticket.username || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            document.getElementById('detailUserId').textContent = ticket.userId || '–ù–µ—Ç ID';
            document.getElementById('detailDate').textContent = dateStr;
            
            const timeOpen = Date.now() - ticket.timestamp;
            const hours = Math.floor(timeOpen / (1000 * 60 * 60));
            const minutes = Math.floor((timeOpen % (1000 * 60 * 60)) / (1000 * 60));
            document.getElementById('detailTimeOpen').textContent = 
                `${hours}—á ${minutes}–º`;
            
            const typeText = ticket.type === 'complaint' ? '‚ö†Ô∏è –ñ–∞–ª–æ–±–∞' : 
                            ticket.type === 'appeal' ? '‚öñÔ∏è –ê–ø–µ–ª–ª—è—Ü–∏—è' : 'üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞';
            const typeClass = ticket.type === 'complaint' ? 'type-complaint' : 
                             ticket.type === 'appeal' ? 'type-appeal' : 'type-support';
            
            document.getElementById('detailType').textContent = typeText;
            document.getElementById('detailType').className = `ticket-type ${typeClass}`;
            
            const statusText = ticket.status === 'new' ? 'üÜï –ù–æ–≤–æ–µ' : 
                              ticket.status === 'read' ? 'üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ' : 
                              ticket.status === 'answered' ? 'üì® –° –æ—Ç–≤–µ—Ç–æ–º' : '‚úÖ –ó–∞–∫—Ä—ã—Ç–æ';
            const statusClass = ticket.status === 'new' ? 'status-new' : 
                               ticket.status === 'read' ? 'status-read' : 
                               ticket.status === 'answered' ? 'status-answered' : 'status-closed';
            
            document.getElementById('detailStatus').textContent = statusText;
            document.getElementById('detailStatus').className = `ticket-status ${statusClass}`;
            
            document.getElementById('detailMessage').textContent = 
                ticket.description || ticket.reason || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è';
            
            const extraInfo = document.getElementById('extraInfo');
            extraInfo.innerHTML = '';
            
            if (ticket.type === 'complaint') {
                extraInfo.innerHTML = `
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">üö´ –ù–∞—Ä—É—à–∏—Ç–µ–ª—å</div>
                            <div class="info-value">${ticket.violatorNickname || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üïê –í—Ä–µ–º—è –Ω–∞—Ä—É—à–µ–Ω–∏—è</div>
                            <div class="info-value">${ticket.violationTime || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</div>
                        </div>
                    </div>
                `;
                
                if (ticket.proof) {
                    document.getElementById('proofSection').style.display = 'block';
                    document.getElementById('detailProof').innerHTML = formatLinks(ticket.proof);
                } else {
                    document.getElementById('proofSection').style.display = 'none';
                }
                
            } else if (ticket.type === 'appeal') {
                extraInfo.innerHTML = `
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">‚öñÔ∏è –¢–∏–ø –Ω–∞–∫–∞–∑–∞–Ω–∏—è</div>
                            <div class="info-value">${ticket.punishmentType || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">üìÖ –î–∞—Ç–∞ –Ω–∞–∫–∞–∑–∞–Ω–∏—è</div>
                            <div class="info-value">${ticket.punishmentDate || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</div>
                        </div>
                    </div>
                `;
                
                if (ticket.proof) {
                    document.getElementById('proofSection').style.display = 'block';
                    document.getElementById('detailProof').innerHTML = formatLinks(ticket.proof);
                } else {
                    document.getElementById('proofSection').style.display = 'none';
                }
                
            } else if (ticket.type === 'support') {
                extraInfo.innerHTML = `
                    <div class="info-item">
                        <div class="info-label">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è</div>
                        <div class="info-value">${ticket.category || '–ù–µ —É–∫–∞–∑–∞–Ω–∞'}</div>
                    </div>
                `;
                
                if (ticket.additionalInfo) {
                    document.getElementById('proofSection').style.display = 'block';
                    document.getElementById('detailProof').textContent = ticket.additionalInfo;
                } else {
                    document.getElementById('proofSection').style.display = 'none';
                }
            }
            
            setTimeout(() => {
                document.getElementById('responseText').focus();
            }, 100);
        }
        
        // ==================== –û–¢–í–ï–¢ –ù–ê –¢–ò–ö–ï–¢ ====================
        async function sendResponse() {
            const responseText = document.getElementById('responseText').value.trim();
            
            if (!responseText) {
                showMessage('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞!', 'error');
                return;
            }
            
            if (!selectedTicketData) {
                showMessage('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ!', 'error');
                return;
            }
            
            try {
                const adminName = currentAdmin.name;
                
                await database.ref(`support_tickets/${selectedTicketId}/adminAnswer`).set(responseText);
                await database.ref(`support_tickets/${selectedTicketId}/adminName`).set(adminName);
                await database.ref(`support_tickets/${selectedTicketId}/adminIP`).set(currentAdmin.ip);
                await database.ref(`support_tickets/${selectedTicketId}/answerTime`).set(Date.now());
                await database.ref(`support_tickets/${selectedTicketId}/status`).set('answered');
                
                const answerRef = database.ref(`ticket_answers/${selectedTicketId}`).push();
                await answerRef.set({
                    text: responseText,
                    adminName: adminName,
                    adminIP: currentAdmin.ip,
                    timestamp: Date.now()
                });
                
                await logAction('answer', `–û—Ç–≤–µ—Ç–∏–ª –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ ${selectedTicketData.ticketId}`);
                
                selectedTicketData.adminAnswer = responseText;
                selectedTicketData.adminName = adminName;
                selectedTicketData.status = 'answered';
                selectedTicketData.answerTime = Date.now();
                
                setupAutoDelete(selectedTicketId, selectedTicketData);
                
                showMessage('‚úÖ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∏–≥—Ä–æ–∫—É! –¢–∏–∫–µ—Ç –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç.', 'success');
                document.getElementById('responseText').value = '';
                
                loadTicketAnswers(selectedTicketId);
                updateTicketsList();
                updateStats();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞', 'error');
            }
        }
        
        async function closeTicket() {
            if (!selectedTicketData) {
                showMessage('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ!', 'error');
                return;
            }
            
            if (confirm('–ó–∞–∫—Ä—ã—Ç—å —ç—Ç–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ? –û–Ω–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç.')) {
                try {
                    await database.ref(`support_tickets/${selectedTicketId}/status`).set('closed');
                    await database.ref(`support_tickets/${selectedTicketId}/closedBy`).set(currentAdmin.name);
                    await database.ref(`support_tickets/${selectedTicketId}/closedTime`).set(Date.now());
                    
                    await logAction('close', `–ó–∞–∫—Ä—ã–ª –æ–±—Ä–∞—â–µ–Ω–∏–µ ${selectedTicketData.ticketId}`);
                    
                    selectedTicketData.status = 'closed';
                    selectedTicketData.closedTime = Date.now();
                    
                    setupAutoDelete(selectedTicketId, selectedTicketData);
                    
                    showMessage('‚úÖ –û–±—Ä–∞—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ! –ë—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç.', 'success');
                    updateTicketsList();
                    updateStats();
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è:', error);
                    showMessage('‚ùå –û—à–∏–±–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–±—Ä–∞—â–µ–Ω–∏—è', 'error');
                }
            }
        }
        
        async function deleteTicket() {
            if (!selectedTicketData) {
                showMessage('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ!', 'error');
                return;
            }
            
            if (confirm('–í–ù–ò–ú–ê–ù–ò–ï! –£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
                try {
                    await database.ref(`support_tickets/${selectedTicketId}`).remove();
                    await logAction('delete', `–£–¥–∞–ª–∏–ª –æ–±—Ä–∞—â–µ–Ω–∏–µ ${selectedTicketData.ticketId}`);
                    
                    allTickets = allTickets.filter(t => t.id !== selectedTicketId);
                    
                    showMessage('‚úÖ –û–±—Ä–∞—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!', 'success');
                    
                    selectedTicketId = null;
                    selectedTicketData = null;
                    
                    document.getElementById('ticketDetails').classList.remove('active');
                    updateTicketsList();
                    updateStats();
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                    showMessage('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –æ–±—Ä–∞—â–µ–Ω–∏—è', 'error');
                }
            }
        }
        
        function skipTicket() {
            const currentIndex = filteredTickets.findIndex(t => t.id === selectedTicketId);
            if (currentIndex < filteredTickets.length - 1) {
                selectTicket(filteredTickets[currentIndex + 1].id);
            } else if (filteredTickets.length > 0) {
                selectTicket(filteredTickets[0].id);
            }
        }
        
        // ==================== –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        async function loadTicketAnswers(ticketId) {
            try {
                const snapshot = await database.ref(`ticket_answers/${ticketId}`).once('value');
                const answersList = document.getElementById('answersList');
                
                if (!snapshot.exists()) {
                    document.getElementById('answersSection').style.display = 'none';
                    return;
                }
                
                document.getElementById('answersSection').style.display = 'block';
                
                let html = '';
                const answers = [];
                
                snapshot.forEach(childSnapshot => {
                    answers.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                
                answers.sort((a, b) => a.timestamp - b.timestamp);
                
                answers.forEach(answer => {
                    const date = new Date(answer.timestamp);
                    const dateStr = date.toLocaleDateString() + ' ' + 
                                   date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    
                    html += `
                        <div style="margin-bottom: 15px; padding: 15px; background: rgba(0,100,255,0.1); border-radius: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                <strong style="color: #6ab7ff;">${answer.adminName}</strong>
                                <small style="color: #aaa;">${dateStr}</small>
                            </div>
                            <div style="color: white; line-height: 1.5;">
                                ${answer.text}
                            </div>
                        </div>
                    `;
                });
                
                answersList.innerHTML = html;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤:', error);
            }
        }
        
        async function loadActionLog(ticketId) {
            try {
                const snapshot = await database.ref(`ticket_logs/${ticketId}`)
                    .orderByChild('timestamp')
                    .limitToLast(20)
                    .once('value');
                
                const logList = document.getElementById('logList');
                
                if (!snapshot.exists()) {
                    logList.innerHTML = '<div class="log-item">–î–µ–π—Å—Ç–≤–∏–π –ø–æ–∫–∞ –Ω–µ—Ç</div>';
                    return;
                }
                
                let html = '';
                const logs = [];
                
                snapshot.forEach(childSnapshot => {
                    logs.push(childSnapshot.val());
                });
                
                logs.sort((a, b) => b.timestamp - a.timestamp);
                
                logs.forEach(log => {
                    const date = new Date(log.timestamp);
                    const dateStr = date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                    
                    html += `
                        <div class="log-item">
                            <span class="log-time">${dateStr}</span>
                            <span class="log-admin">${log.adminName}:</span>
                            <span class="log-action"> ${log.action}</span>
                        </div>
                    `;
                });
                
                logList.innerHTML = html;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤:', error);
            }
        }
        
        async function logAction(action, description) {
            try {
                await database.ref(`ticket_logs/${selectedTicketId}`).push({
                    action: description,
                    adminName: currentAdmin.name,
                    adminIP: currentAdmin.ip,
                    timestamp: Date.now()
                });
                
                await database.ref('admin_log').push({
                    ticketId: selectedTicketData.ticketId,
                    action: action,
                    adminName: currentAdmin.name,
                    adminIP: currentAdmin.ip,
                    timestamp: Date.now(),
                    description: description
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
            }
        }
        
        // ==================== –ë–´–°–¢–†–´–ï –î–ï–ô–°–¢–í–ò–Ø ====================
        async function markAllAsRead() {
            if (!confirm('–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –Ω–æ–≤—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ?')) return;
            
            try {
                const updates = {};
                allTickets.forEach(ticket => {
                    if (ticket.status === 'new') {
                        updates[`support_tickets/${ticket.id}/status`] = 'read';
                        ticket.status = 'read';
                    }
                });
                
                await database.ref().update(updates);
                await logAction('mark_all_read', '–û—Ç–º–µ—Ç–∏–ª –≤—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ');
                
                showMessage('‚úÖ –í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ!', 'success');
                updateTicketsList();
                updateStats();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showMessage('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤', 'error');
            }
        }
        
        function exportAllTickets() {
            const dataStr = JSON.stringify(allTickets, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `jojoland_tickets_export_${Date.now()}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showMessage('üì• –í—Å–µ –æ–±—Ä–∞—â–µ–Ω–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ JSON —Ñ–∞–π–ª!', 'success');
        }
        
        function showStats() {
            const stats = calculateStats();
            
            const message = `
                üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏:
                
                –í—Å–µ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏–π: ${stats.total}
                –ù–æ–≤—ã—Ö: ${stats.new}
                –ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö: ${stats.read}
                –° –æ—Ç–≤–µ—Ç–æ–º: ${stats.answered}
                –ó–∞–∫—Ä—ã—Ç—ã—Ö: ${stats.closed}
                
                –ñ–∞–ª–æ–±: ${stats.complaints}
                –ê–ø–µ–ª–ª—è—Ü–∏–π: ${stats.appeals}
                –û–±—Ä–∞—â–µ–Ω–∏–π –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É: ${stats.support}
                
                –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: ${stats.avgResponseTime}
                –û–±—Ä–∞—â–µ–Ω–∏–π —Å–µ–≥–æ–¥–Ω—è: ${stats.today}
            `;
            
            alert(message);
        }
        
        function calculateStats() {
            const now = Date.now();
            const today = new Date().setHours(0,0,0,0);
            
            let totalResponseTime = 0;
            let answeredCount = 0;
            
            allTickets.forEach(ticket => {
                if (ticket.answerTime && ticket.timestamp) {
                    totalResponseTime += (ticket.answerTime - ticket.timestamp);
                    answeredCount++;
                }
            });
            
            const avgResponseTime = answeredCount > 0 
                ? Math.floor(totalResponseTime / answeredCount / (1000 * 60 * 60)) + '—á'
                : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            
            const todayCount = allTickets.filter(t => new Date(t.timestamp) >= today).length;
            
            document.getElementById('responseTime').textContent = avgResponseTime;
            
            return {
                total: allTickets.length,
                new: allTickets.filter(t => t.status === 'new').length,
                read: allTickets.filter(t => t.status === 'read').length,
                answered: allTickets.filter(t => t.status === 'answered').length,
                closed: allTickets.filter(t => t.status === 'closed').length,
                complaints: allTickets.filter(t => t.type === 'complaint').length,
                appeals: allTickets.filter(t => t.type === 'appeal').length,
                support: allTickets.filter(t => t.type === 'support').length,
                avgResponseTime: avgResponseTime,
                today: todayCount
            };
        }
        
        function updateStats() {
            calculateStats();
        }
        
        function searchTickets() {
            const searchText = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (!searchText) {
                currentStatusFilter = null;
                updateTicketsList();
                return;
            }
            
            filteredTickets = allTickets.filter(ticket => {
                return (
                    (ticket.ticketId && ticket.ticketId.toLowerCase().includes(searchText)) ||
                    (ticket.userNickname && ticket.userNickname.toLowerCase().includes(searchText)) ||
                    (ticket.username && ticket.username.toLowerCase().includes(searchText)) ||
                    (ticket.description && ticket.description.toLowerCase().includes(searchText)) ||
                    (ticket.reason && ticket.reason.toLowerCase().includes(searchText))
                );
            });
            
            const ticketsList = document.getElementById('ticketsList');
            
            if (filteredTickets.length === 0) {
                ticketsList.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #aaa;">
                        üîç –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É: "${searchText}"
                    </div>
                `;
                return;
            }
            
            updateTicketsList();
        }
        
        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function truncateText(text, maxLength) {
            if (!text) return '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è';
            if (text.length <= maxLength) return text;
            return text.substr(0, maxLength) + '...';
        }
        
        function formatLinks(text) {
            if (!text) return '–ù–µ—Ç –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤';
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            return text.replace(urlRegex, url => {
                return `<a href="${url}" target="_blank" style="color: #6ab7ff;">${url}</a>`;
            }).replace(/\n/g, '<br>');
        }
        
        function showMessage(message, type = 'info') {
            alert(`[${type.toUpperCase()}] ${message}`);
        }
        
        // ==================== –ó–ê–ü–£–°–ö ====================
        document.addEventListener('DOMContentLoaded', () => {
            const sessionActive = localStorage.getItem('adminSession');
            if (sessionActive === 'active') {
                loginSuccess();
            }
            
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchTickets();
                }
            });
            
            document.getElementById('passwordInput').focus();
        });
    </script>
</body>
</html>
