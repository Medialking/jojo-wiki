<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>JojoLand Admin</title>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #110018;
            color: white;
        }

        .container {
            width: 90%;
            max-width: 900px;
            margin: auto;
            padding-top: 25px;
        }

        h1 {
            text-align: center;
            margin-bottom: 25px;
        }

        .panel {
            background: rgba(255,255,255,0.07);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        input, button {
            padding: 10px;
            border: none;
            border-radius: 6px;
            margin: 5px 0;
        }

        button {
            background: #ff00cc;
            color: white;
            cursor: pointer;
        }

        button:hover {
            background: #ff33dd;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
<div class="container">

    <h1>üîê JojoLand Admin Panel</h1>

    <!-- –°—Ç–∞—Ç—É—Å –≤—Ö–æ–¥–∞ -->
    <div id="authStatus">‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞...</div>

    <!-- –ü–∞–Ω–µ–ª—å –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∞ -->
    <div id="superAdminPanel" class="panel hidden">
        <h2>üëë –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Staff</h2>

        <input id="newStaffUID" placeholder="UID –∏–≥—Ä–æ–∫–∞">
        <button onclick="addStaff()">–î–æ–±–∞–≤–∏—Ç—å –≤ Staff</button>

        <input id="removeStaffUID" placeholder="UID –∏–≥—Ä–æ–∫–∞">
        <button onclick="removeStaff()">–£–¥–∞–ª–∏—Ç—å –∏–∑ Staff</button>

        <p id="adminMessage"></p>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ -->
    <div id="staffPanel" class="panel hidden">
        <h2>üé´ –¢–∏–∫–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h2>
        <div id="ticketsList"></div>
    </div>

</div>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>

<script>
// -----------------------------------------------------
// Firebase config ‚Äî —Ç–≤–æ–π –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π
// -----------------------------------------------------
const firebaseConfig = {
    apiKey: "AIzaSyBwhNixWO8dF_drN2hHVYzfTAbMCiT91Gw",
    authDomain: "jojoland-chat.firebaseapp.com",
    databaseURL: "https://jojoland-chat-default-rtdb.firebaseio.com",
    projectId: "jojoland-chat",
    storageBucket: "jojoland-chat.firebasestorage.app",
    messagingSenderId: "602788305122",
    appId: "1:602788305122:web:c03f5b5ef59c85fc9fe6bb"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

// -----------------------------------------------------
// –¢–í–û–ô UID ‚Äî –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω
// -----------------------------------------------------
const SUPER_ADMIN = "w51qspQCTJReZUvbOyUmII0wSvG3";

// -----------------------------------------------------
// –ì—Ä—É–ø–ø–∞ –∞–¥–º–∏–Ω–æ–≤ —Ç–µ–ø–µ—Ä—å: staff
// -----------------------------------------------------
const STAFF_NODE = "staff";

// –ê–≤—Ç–æ–≤—Ö–æ–¥ (Google OAuth)
auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
.then(result => {
    const user = result.user;
    const uid = user.uid;

    document.getElementById("authStatus").innerText = "–ü—Ä–∏–≤–µ—Ç, " + user.displayName;

    checkAccess(uid);
})
.catch(err => {
    document.getElementById("authStatus").innerText = "–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: " + err.message;
});

// -----------------------------------------------------
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
// -----------------------------------------------------
function checkAccess(uid) {
    if (uid === SUPER_ADMIN) {
        document.getElementById("superAdminPanel").classList.remove("hidden");
        document.getElementById("staffPanel").classList.remove("hidden");
        loadTickets();
        return;
    }

    db.ref(STAFF_NODE + "/" + uid).once("value", snap => {
        if (snap.exists()) {
            document.getElementById("staffPanel").classList.remove("hidden");
            loadTickets();
        } else {
            document.getElementById("authStatus").innerText = "‚õî –£ –≤–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞";
        }
    });
}

// -----------------------------------------------------
// SUPER ADMIN ‚Äî –î–æ–±–∞–≤–∏—Ç—å staff
// -----------------------------------------------------
function addStaff() {
    const uid = document.getElementById("newStaffUID").value.trim();

    if (!uid) return alert("–í–≤–µ–¥–∏—Ç–µ UID!");

    db.ref(STAFF_NODE + "/" + uid).set({
        promotedAt: Date.now(),
        promotedBy: SUPER_ADMIN
    });

    document.getElementById("adminMessage").innerText = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ staff!";
}

// -----------------------------------------------------
// SUPER ADMIN ‚Äî –£–¥–∞–ª–∏—Ç—å staff
// -----------------------------------------------------
function removeStaff() {
    const uid = document.getElementById("removeStaffUID").value.trim();

    if (!uid) return alert("–í–≤–µ–¥–∏—Ç–µ UID!");

    db.ref(STAFF_NODE + "/" + uid).remove();

    document.getElementById("adminMessage").innerText = "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—ë–Ω –∏–∑ staff!";
}

// -----------------------------------------------------
// –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤
// -----------------------------------------------------
function loadTickets() {
    db.ref("support_tickets").on("value", snap => {
        const list = document.getElementById("ticketsList");
        list.innerHTML = "";

        snap.forEach(ticket => {
            const data = ticket.val();

            const div = document.createElement("div");
            div.className = "panel";
            div.innerHTML = `
                <b>–ê–≤—Ç–æ—Ä:</b> ${data.username}<br>
                <b>–°–æ–æ–±—â–µ–Ω–∏–µ:</b> ${data.message}<br><br>
            `;
            list.appendChild(div);
        });
    });
}
</script>

</body>
</html>
