<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å JojoLand</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-dark: #0a001a;
            --secondary-dark: #1a0033;
            --accent-red: #ff3366;
            --accent-green: #00ff99;
            --accent-blue: #00ccff;
            --accent-yellow: #ffcc00;
            --text-light: #ffffff;
            --text-secondary: #b3b3ff;
            --bg-card: rgba(20, 0, 40, 0.9);
            --danger-bg: rgba(255, 0, 0, 0.1);
            --success-bg: rgba(0, 255, 0, 0.1);
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-dark), var(--secondary-dark));
            color: var(--text-light);
            min-height: 100vh;
            padding: 20px;
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            border: 2px solid var(--accent-red);
        }
        
        .admin-header h1 {
            font-size: 2.5rem;
            color: var(--accent-yellow);
            text-shadow: 0 0 15px rgba(255, 204, 0, 0.5);
        }
        
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card h3 {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        
        .stat-card .count {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--accent-blue);
        }
        
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
        }
        
        .filter-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: var(--accent-blue);
            color: var(--primary-dark);
            border-color: var(--accent-blue);
        }
        
        .filter-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .tickets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
            gap: 25px;
        }
        
        .ticket-card {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            position: relative;
        }
        
        .ticket-card.new {
            border-left: 5px solid var(--accent-red);
            animation: pulse 2s infinite;
        }
        
        .ticket-card.read {
            border-left: 5px solid var(--accent-blue);
        }
        
        .ticket-card.answered {
            border-left: 5px solid var(--accent-green);
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 51, 102, 0.4); }
            50% { box-shadow: 0 0 0 10px rgba(255, 51, 102, 0); }
        }
        
        .ticket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .ticket-id {
            font-size: 0.9rem;
            color: var(--text-secondary);
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .ticket-type {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        .type-complaint { background: rgba(255, 51, 102, 0.2); color: var(--accent-red); }
        .type-appeal { background: rgba(0, 204, 255, 0.2); color: var(--accent-blue); }
        .type-support { background: rgba(0, 255, 153, 0.2); color: var(--accent-green); }
        
        .ticket-info {
            margin-bottom: 20px;
        }
        
        .ticket-info-row {
            display: flex;
            margin-bottom: 10px;
            align-items: flex-start;
        }
        
        .ticket-info-label {
            min-width: 120px;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .ticket-info-value {
            flex: 1;
            color: var(--text-light);
            word-break: break-word;
        }
        
        .admin-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-answer {
            background: var(--accent-blue);
            color: var(--primary-dark);
        }
        
        .btn-status {
            background: var(--accent-green);
            color: var(--primary-dark);
        }
        
        .btn-delete {
            background: var(--accent-red);
            color: white;
        }
        
        .action-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .answer-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .answer-input {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: var(--text-light);
            font-size: 1rem;
            margin-bottom: 10px;
            resize: vertical;
        }
        
        .answer-input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }
        
        .answers-list {
            margin-top: 20px;
        }
        
        .answer-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 3px solid var(--accent-green);
        }
        
        .answer-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .answer-author {
            font-weight: bold;
            color: var(--accent-green);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: var(--text-secondary);
        }
        
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 10px 15px;
            background: var(--accent-red);
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: bold;
            z-index: 100;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .modal-content {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            border: 2px solid var(--accent-red);
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .login-form {
            max-width: 400px;
            margin: 100px auto;
            padding: 30px;
            background: var(--bg-card);
            border-radius: 15px;
            border: 2px solid var(--accent-blue);
        }
        
        .login-input {
            width: 100%;
            padding: 15px;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: var(--text-light);
            font-size: 1rem;
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            background: var(--accent-blue);
            color: var(--primary-dark);
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
        }
        
        .admin-name-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .admin-name-input input {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-light);
        }
        
        .admin-name-input button {
            padding: 10px 20px;
            background: var(--accent-green);
            color: var(--primary-dark);
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-btn">‚¨ÖÔ∏è –ù–∞ —Å–∞–π—Ç</a>
    
    <div id="loginScreen" class="login-form">
        <h2 style="text-align: center; margin-bottom: 30px; color: var(--accent-yellow);">üîê –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h2>
        <input type="password" id="adminPassword" class="login-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞">
        <div class="admin-name-input">
            <input type="text" id="adminNameInput" placeholder="–í–∞—à–µ –∏–º—è (–æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç–∞—Ö)">
            <button onclick="setAdminName()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
        <button onclick="login()" class="login-btn">–í–æ–π—Ç–∏</button>
    </div>
    
    <div id="adminPanel" style="display: none;">
        <div class="admin-container">
            <header class="admin-header">
                <h1>üëë –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å JojoLand</h1>
                <p id="adminGreeting">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä!</p>
                <div style="margin-top: 10px;">
                    <button onclick="logout()" style="padding: 5px 15px; background: var(--accent-red); color: white; border: none; border-radius: 8px; cursor: pointer;">
                        –í—ã–π—Ç–∏
                    </button>
                </div>
            </header>
            
            <div class="stats-cards">
                <div class="stat-card">
                    <h3>–í—Å–µ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏–π</h3>
                    <div class="count" id="totalTickets">0</div>
                </div>
                <div class="stat-card">
                    <h3>–ù–æ–≤—ã–µ</h3>
                    <div class="count" id="newTickets">0</div>
                </div>
                <div class="stat-card">
                    <h3>–° –æ—Ç–≤–µ—Ç–æ–º</h3>
                    <div class="count" id="answeredTickets">0</div>
                </div>
                <div class="stat-card">
                    <h3>–ó–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
                    <div class="count" id="todayTickets">0</div>
                </div>
            </div>
            
            <div class="filters">
                <button class="filter-btn active" onclick="filterTickets('all')">–í—Å–µ</button>
                <button class="filter-btn" onclick="filterTickets('new')">üÜï –ù–æ–≤—ã–µ</button>
                <button class="filter-btn" onclick="filterTickets('complaint')">‚ö†Ô∏è –ñ–∞–ª–æ–±—ã</button>
                <button class="filter-btn" onclick="filterTickets('appeal')">‚öñÔ∏è –ê–ø–µ–ª–ª—è—Ü–∏–∏</button>
                <button class="filter-btn" onclick="filterTickets('support')">üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
                <button class="filter-btn" onclick="filterTickets('answered')">‚úÖ –° –æ—Ç–≤–µ—Ç–æ–º</button>
            </div>
            
            <div id="ticketsContainer" class="tickets-grid">
                <!-- –°—é–¥–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –æ–±—Ä–∞—â–µ–Ω–∏—è -->
            </div>
            
            <div id="noTicketsMessage" class="loading" style="display: none;">
                –û–±—Ä–∞—â–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
            </div>
        </div>
    </div>
    
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
            <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
            <div class="modal-buttons">
                <button onclick="confirmDelete()" style="background: var(--accent-red); color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer;">
                    –£–¥–∞–ª–∏—Ç—å
                </button>
                <button onclick="cancelDelete()" style="background: var(--accent-blue); color: white; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer;">
                    –û—Ç–º–µ–Ω–∞
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // ==================== –ö–û–ù–§–ò–ì FIREBASE (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ—Ç –∂–µ) ====================
        const firebaseConfig = {
            apiKey: "AIzaSyBwhNixWO8dF_drN2hHVYzfTAbMCiT91Gw",
            authDomain: "jojoland-chat.firebaseapp.com",
            databaseURL: "https://jojoland-chat-default-rtdb.firebaseio.com",
            projectId: "jojoland-chat",
            storageBucket: "jojoland-chat.firebasestorage.app",
            messagingSenderId: "602788305122",
            appId: "1:602788305122:web:c03f5b5ef59c85fc9fe6bb"
        };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();
        
        // ==================== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let currentFilter = 'all';
        let tickets = [];
        let deleteTicketId = null;
        const ADMIN_PASSWORD = 'jojoland2024'; // –ü–æ–º–µ–Ω—è–π—Ç–µ —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å!
        
        // ==================== –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø ====================
        function login() {
            const password = document.getElementById('adminPassword').value;
            const adminName = localStorage.getItem('jojoland_admin_name') || '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
            
            if (password === ADMIN_PASSWORD) {
                localStorage.setItem('adminLoggedIn', 'true');
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('adminGreeting').textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${adminName}!`;
                loadTickets();
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
            }
        }
        
        function setAdminName() {
            const nameInput = document.getElementById('adminNameInput').value;
            if (nameInput.trim().length > 0) {
                localStorage.setItem('jojoland_admin_name', nameInput.trim());
                alert('–ò–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
            }
        }
        
        function logout() {
            localStorage.removeItem('adminLoggedIn');
            location.reload();
        }
        
        function checkAuth() {
            const adminName = localStorage.getItem('jojoland_admin_name') || '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
            document.getElementById('adminNameInput').value = adminName;
            
            if (localStorage.getItem('adminLoggedIn') === 'true') {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('adminGreeting').textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${adminName}!`;
                loadTickets();
            }
        }
        
        // ==================== –ó–ê–ì–†–£–ó–ö–ê –û–ë–†–ê–©–ï–ù–ò–ô ====================
        function loadTickets() {
            const ticketsRef = database.ref('support_tickets').orderByChild('timestamp');
            
            ticketsRef.on('value', snapshot => {
                if (!snapshot.exists()) {
                    tickets = [];
                    updateUI();
                    return;
                }
                
                const data = snapshot.val();
                tickets = Object.keys(data).map(key => ({
                    id: key,
                    ...data[key]
                }));
                
                // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (—Å–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ)
                tickets.sort((a, b) => b.timestamp - a.timestamp);
                
                updateStats();
                updateUI();
            });
        }
        
        function updateStats() {
            const total = tickets.length;
            const newTickets = tickets.filter(t => t.status === 'new').length;
            const answered = tickets.filter(t => t.status === 'answered').length;
            
            // –°—á–∏—Ç–∞–µ–º –∑–∞ —Å–µ–≥–æ–¥–Ω—è
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const todayTickets = tickets.filter(t => {
                const ticketDate = new Date(t.timestamp);
                return ticketDate >= today;
            }).length;
            
            document.getElementById('totalTickets').textContent = total;
            document.getElementById('newTickets').textContent = newTickets;
            document.getElementById('answeredTickets').textContent = answered;
            document.getElementById('todayTickets').textContent = todayTickets;
        }
        
        function updateUI() {
            const container = document.getElementById('ticketsContainer');
            const noTicketsMessage = document.getElementById('noTicketsMessage');
            
            let filteredTickets = tickets;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            if (currentFilter === 'new') {
                filteredTickets = tickets.filter(t => t.status === 'new');
            } else if (currentFilter === 'complaint') {
                filteredTickets = tickets.filter(t => t.type === 'complaint');
            } else if (currentFilter === 'appeal') {
                filteredTickets = tickets.filter(t => t.type === 'appeal');
            } else if (currentFilter === 'support') {
                filteredTickets = tickets.filter(t => t.type === 'support');
            } else if (currentFilter === 'answered') {
                filteredTickets = tickets.filter(t => t.status === 'answered');
            }
            
            if (filteredTickets.length === 0) {
                container.innerHTML = '';
                noTicketsMessage.style.display = 'block';
                return;
            }
            
            noTicketsMessage.style.display = 'none';
            container.innerHTML = '';
            
            filteredTickets.forEach(ticket => {
                container.innerHTML += createTicketCard(ticket);
            });
        }
        
        function filterTickets(filter) {
            currentFilter = filter;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            updateUI();
        }
        
        // ==================== –°–û–ó–î–ê–ù–ò–ï –ö–ê–†–¢–û–ß–ö–ò –û–ë–†–ê–©–ï–ù–ò–Ø ====================
        function createTicketCard(ticket) {
            const typeText = ticket.type === 'complaint' ? '–ñ–∞–ª–æ–±–∞' : 
                            ticket.type === 'appeal' ? '–ê–ø–µ–ª–ª—è—Ü–∏—è' : 
                            '–ü–æ–¥–¥–µ—Ä–∂–∫–∞';
                            
            const statusClass = ticket.status === 'new' ? 'new' : 
                              ticket.status === 'read' ? 'read' : 
                              'answered';
            
            const typeClass = `type-${ticket.type}`;
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
            const date = new Date(ticket.timestamp);
            const formattedDate = date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –æ—Ç–≤–µ—Ç–æ–≤
            let answersHtml = '';
            if (ticket.answers) {
                const answers = Object.values(ticket.answers);
                answers.sort((a, b) => a.timestamp - b.timestamp);
                
                answers.forEach(answer => {
                    const isAdmin = answer.senderId !== ticket.userId;
                    const answerDate = new Date(answer.timestamp);
                    const answerFormattedDate = answerDate.toLocaleDateString('ru-RU', {
                        day: '2-digit',
                        month: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    answersHtml += `
                        <div class="answer-item">
                            <div class="answer-header">
                                <span class="answer-author">
                                    ${isAdmin ? 'üëë ' + (answer.adminName || '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') : 'üë§ ' + ticket.username}
                                </span>
                                <small>${answerFormattedDate}</small>
                            </div>
                            <p style="color: white;">${escapeHtml(answer.text)}</p>
                        </div>
                    `;
                });
            }
            
            return `
                <div class="ticket-card ${statusClass}">
                    <div class="ticket-header">
                        <div>
                            <h3 style="color: white; margin-bottom: 5px;">${typeText}</h3>
                            <span class="ticket-id">#${ticket.id.substr(0, 8)}</span>
                        </div>
                        <span class="ticket-type ${typeClass}">${typeText}</span>
                    </div>
                    
                    <div class="ticket-info">
                        <div class="ticket-info-row">
                            <span class="ticket-info-label">üë§ –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å:</span>
                            <span class="ticket-info-value">${ticket.username || '–ê–Ω–æ–Ω–∏–º'}</span>
                        </div>
                        
                        ${ticket.targetNickname ? `
                            <div class="ticket-info-row">
                                <span class="ticket-info-label">üéØ –¶–µ–ª—å:</span>
                                <span class="ticket-info-value">${escapeHtml(ticket.targetNickname)}</span>
                            </div>
                        ` : ''}
                        
                        <div class="ticket-info-row">
                            <span class="ticket-info-label">üìù –û–ø–∏—Å–∞–Ω–∏–µ:</span>
                            <span class="ticket-info-value">${escapeHtml(ticket.description)}</span>
                        </div>
                        
                        ${ticket.reason ? `
                            <div class="ticket-info-row">
                                <span class="ticket-info-label">üîó –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:</span>
                                <span class="ticket-info-value">${escapeHtml(ticket.reason)}</span>
                            </div>
                        ` : ''}
                        
                        <div class="ticket-info-row">
                            <span class="ticket-info-label">üìÖ –î–∞—Ç–∞:</span>
                            <span class="ticket-info-value">${formattedDate}</span>
                        </div>
                    </div>
                    
                    ${answersHtml ? `
                        <div class="answers-list">
                            <h4 style="color: var(--accent-green); margin-bottom: 10px;">üì® –û—Ç–≤–µ—Ç—ã:</h4>
                            ${answersHtml}
                        </div>
                    ` : ''}
                    
                    <div class="answer-section" id="answerSection_${ticket.id}">
                        <textarea 
                            class="answer-input" 
                            id="answerInput_${ticket.id}" 
                            placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –Ω–∞ —ç—Ç–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ..."
                        ></textarea>
                        
                        <div class="admin-actions">
                            <button onclick="sendAnswer('${ticket.id}')" class="action-btn btn-answer">
                                üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç
                            </button>
                            
                            <button onclick="changeStatus('${ticket.id}', '${ticket.status === 'new' ? 'read' : ticket.status === 'read' ? 'answered' : 'new'}')" 
                                    class="action-btn btn-status">
                                ${ticket.status === 'new' ? 'üëÅÔ∏è –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ' : 
                                  ticket.status === 'read' ? '‚úÖ –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –æ—Ç–≤–µ—á–µ–Ω–Ω–æ–µ' : 
                                  'üÜï –í–µ—Ä–Ω—É—Ç—å –≤ –Ω–æ–≤—ã–µ'}
                            </button>
                            
                            <button onclick="openDeleteModal('${ticket.id}')" class="action-btn btn-delete">
                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ==================== –§–£–ù–ö–¶–ò–ò –ê–î–ú–ò–ù–ò–°–¢–†–ò–†–û–í–ê–ù–ò–Ø ====================
        function sendAnswer(ticketId) {
            const answerInput = document.getElementById(`answerInput_${ticketId}`);
            const answerText = answerInput.value.trim();
            
            if (!answerText) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞!');
                return;
            }
            
            const adminName = localStorage.getItem('jojoland_admin_name') || '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
            
            const answerData = {
                text: answerText,
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                senderId: 'admin_' + Date.now(), // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –∞–¥–º–∏–Ω–∞
                adminName: adminName
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –≤ –±–∞–∑—É
            database.ref(`support_tickets/${ticketId}/answers`).push(answerData)
                .then(() => {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞ "–æ—Ç–≤–µ—á–µ–Ω–æ"
                    database.ref(`support_tickets/${ticketId}/status`).set('answered');
                    
                    answerInput.value = '';
                    alert('–û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!');
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞:', error);
                    alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞!');
                });
        }
        
        function changeStatus(ticketId, newStatus) {
            database.ref(`support_tickets/${ticketId}/status`).set(newStatus)
                .then(() => {
                    alert('–°—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª–µ–Ω!');
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', error);
                    alert('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞!');
                });
        }
        
        function openDeleteModal(ticketId) {
            deleteTicketId = ticketId;
            document.getElementById('deleteModal').style.display = 'flex';
        }
        
        function confirmDelete() {
            if (deleteTicketId) {
                database.ref(`support_tickets/${deleteTicketId}`).remove()
                    .then(() => {
                        alert('–û–±—Ä–∞—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!');
                        cancelDelete();
                    })
                    .catch(error => {
                        console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                        alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è!');
                    });
            }
        }
        
        function cancelDelete() {
            deleteTicketId = null;
            document.getElementById('deleteModal').style.display = 'none';
        }
        
        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function escapeHtml(text) {
            if (!text) return '';
            return text
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;")
                .replace(/\n/g, '<br>');
        }
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            
            // –ê–≤—Ç–æ–ª–æ–≥–∏–Ω –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Enter –≤ –ø–æ–ª–µ –ø–∞—Ä–æ–ª—è
            document.getElementById('adminPassword').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    login();
                }
            });
        });
    </script>
</body>
</html>
