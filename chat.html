<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ JojoLand</title>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a0033, #330066, #1a0033);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .back-btn {
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 20px;
            background: rgba(255,0,255,0.2);
            color: #ffb3ff;
            text-decoration: none;
            border-radius: 25px;
            border: 1px solid rgba(255,0,255,0.4);
            transition: 0.3s;
            font-weight: bold;
        }
        
        .back-btn:hover {
            background: rgba(255,0,255,0.4);
            transform: translateY(-2px);
        }
        
        .support-container {
            background: rgba(0,0,0,0.6);
            border-radius: 25px;
            padding: 30px;
            border: 3px solid #ff00ff;
            box-shadow: 0 0 40px rgba(255,0,255,0.4);
        }
        
        h1 {
            text-align: center;
            color: #ffb3ff;
            text-shadow: 0 0 15px #ff00ff;
            margin-bottom: 30px;
            font-size: 32px;
        }
        
        /* –í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è */
        .request-type {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .type-card {
            background: rgba(255,255,255,0.05);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            transition: 0.3s;
            border: 2px solid transparent;
        }
        
        .type-card:hover, .type-card.active {
            background: rgba(255,0,255,0.1);
            border-color: #ff00ff;
            transform: translateY(-5px);
        }
        
        .type-card h3 {
            color: #6ab7ff;
            margin-bottom: 10px;
            font-size: 20px;
        }
        
        .type-card p {
            color: #ccccff;
            font-size: 14px;
            line-height: 1.5;
        }
        
        /* –§–æ—Ä–º–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è */
        .form-container {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .form-container.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #ffb3ff;
            font-weight: bold;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 15px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 16px;
            font-family: inherit;
        }
        
        textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            background: rgba(255,255,255,0.15);
            border: 2px solid #ff00ff;
        }
        
        .submit-btn {
            display: block;
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(90deg, #ff0099, #ff00cc);
            color: white;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            transition: 0.3s;
            margin-top: 20px;
            box-shadow: 0 0 20px rgba(255,0,204,0.5);
        }
        
        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 30px #ff00cc;
        }
        
        /* –°—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ */
        .status-message {
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .status-message.success {
            background: rgba(0,255,0,0.1);
            border: 2px solid #00ff00;
            display: block;
        }
        
        .status-message.error {
            background: rgba(255,0,0,0.1);
            border: 2px solid #ff0000;
            display: block;
        }
        
        /* –ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è */
        .my-requests {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid rgba(255,255,255,0.1);
        }
        
        .request-item {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border-left: 4px solid;
        }
        
        .request-item.complaint { border-color: #ff9900; }
        .request-item.appeal { border-color: #0099ff; }
        .request-item.support { border-color: #00cc99; }
        
        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .request-type-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .badge-complaint { background: rgba(255,153,0,0.2); color: #ff9900; }
        .badge-appeal { background: rgba(0,153,255,0.2); color: #0099ff; }
        .badge-support { background: rgba(0,204,153,0.2); color: #00cc99; }
        
        .request-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-new { background: rgba(255,255,0,0.2); color: #ffff00; }
        .status-read { background: rgba(0,255,0,0.2); color: #00ff00; }
        .status-closed { background: rgba(255,0,0,0.2); color: #ff0000; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @media (max-width: 768px) {
            .support-container {
                padding: 20px;
            }
            
            .request-type {
                grid-template-columns: 1fr;
            }
            
            .request-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-btn">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
        
        <div class="support-container">
            <h1>üõ°Ô∏è –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø–æ–¥–¥–µ—Ä–∂–∫–µ</h1>
            
            <!-- –í—ã–±–æ—Ä —Ç–∏–ø–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è -->
            <div class="request-type">
                <div class="type-card" data-type="complaint" onclick="selectType('complaint')">
                    <h3>‚ö†Ô∏è –ñ–∞–ª–æ–±–∞ –Ω–∞ –∏–≥—Ä–æ–∫–∞</h3>
                    <p>–ü–æ–∂–∞–ª–æ–≤–∞—Ç—å—Å—è –Ω–∞ –Ω–∞—Ä—É—à–∏—Ç–µ–ª—è –ø—Ä–∞–≤–∏–ª, —á–∏—Ç–µ—Ä–∞ –∏–ª–∏ —Ç–æ–∫—Å–∏—á–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞</p>
                </div>
                
                <div class="type-card" data-type="appeal" onclick="selectType('appeal')">
                    <h3>‚öñÔ∏è –ê–ø–µ–ª–ª—è—Ü–∏—è –Ω–∞–∫–∞–∑–∞–Ω–∏—è</h3>
                    <p>–û–±–∂–∞–ª–æ–≤–∞—Ç—å –±–∞–Ω, –º—É—Ç –∏–ª–∏ –¥—Ä—É–≥–æ–µ –Ω–∞–∫–∞–∑–∞–Ω–∏–µ, –µ—Å–ª–∏ —Å—á–∏—Ç–∞–µ—Ç–µ –µ–≥–æ –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–º</p>
                </div>
                
                <div class="type-card" data-type="support" onclick="selectType('support')">
                    <h3>üí¨ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</h3>
                    <p>–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º, –±–∞–≥–∏, –≤–æ–ø—Ä–æ—Å—ã –ø–æ –¥–æ–Ω–∞—Ç—É –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã</p>
                </div>
            </div>
            
            <!-- –§–æ—Ä–º–∞ –∂–∞–ª–æ–±—ã -->
            <div id="complaintForm" class="form-container">
                <h2 style="color: #ff9900; margin-bottom: 20px;">‚ö†Ô∏è –§–æ—Ä–º–∞ –∂–∞–ª–æ–±—ã</h2>
                <div class="form-group">
                    <label for="complaintNickname">–í–∞—à –∏–≥—Ä–æ–≤–æ–π –Ω–∏–∫:</label>
                    <input type="text" id="complaintNickname" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Player123" required>
                </div>
                <div class="form-group">
                    <label for="violatorNickname">–ù–∏–∫ –Ω–∞—Ä—É—à–∏—Ç–µ–ª—è:</label>
                    <input type="text" id="violatorNickname" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: HackerPro" required>
                </div>
                <div class="form-group">
                    <label for="violationTime">–í—Ä–µ–º—è –Ω–∞—Ä—É—à–µ–Ω–∏—è:</label>
                    <input type="text" id="violationTime" placeholder="–ü—Ä–∏–º–µ—Ä: 15.12.2023 20:30" required>
                </div>
                <div class="form-group">
                    <label for="violationDescription">–û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è:</label>
                    <textarea id="violationDescription" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ –æ–ø–∏—à–∏—Ç–µ, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="complaintProof">–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ (—Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ/—Å–∫—Ä–∏–Ω—à–æ—Ç—ã):</label>
                    <textarea id="complaintProof" placeholder="–°—Å—ã–ª–∫–∏ –Ω–∞ YouTube, Imgur, Google Drive –∏ —Ç.–¥."></textarea>
                </div>
                <button class="submit-btn" onclick="submitComplaint()">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∂–∞–ª–æ–±—É</button>
            </div>
            
            <!-- –§–æ—Ä–º–∞ –∞–ø–µ–ª–ª—è—Ü–∏–∏ -->
            <div id="appealForm" class="form-container">
                <h2 style="color: #0099ff; margin-bottom: 20px;">‚öñÔ∏è –§–æ—Ä–º–∞ –∞–ø–µ–ª–ª—è—Ü–∏–∏</h2>
                <div class="form-group">
                    <label for="appealNickname">–í–∞—à –∏–≥—Ä–æ–≤–æ–π –Ω–∏–∫:</label>
                    <input type="text" id="appealNickname" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Player123" required>
                </div>
                <div class="form-group">
                    <label for="punishmentType">–¢–∏–ø –Ω–∞–∫–∞–∑–∞–Ω–∏—è:</label>
                    <select id="punishmentType" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                        <option value="ban">–ë–∞–Ω</option>
                        <option value="mute">–ú—É—Ç –≤ —á–∞—Ç–µ</option>
                        <option value="kick">–ö–∏–∫</option>
                        <option value="warn">–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="punishmentDate">–î–∞—Ç–∞ –Ω–∞–∫–∞–∑–∞–Ω–∏—è:</label>
                    <input type="text" id="punishmentDate" placeholder="–ü—Ä–∏–º–µ—Ä: 15.12.2023" required>
                </div>
                <div class="form-group">
                    <label for="appealReason">–ü–æ—á–µ–º—É —Å—á–∏—Ç–∞–µ—Ç–µ –Ω–∞–∫–∞–∑–∞–Ω–∏–µ –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–º:</label>
                    <textarea id="appealReason" placeholder="–ü–æ–¥—Ä–æ–±–Ω–æ –æ–±—ä—è—Å–Ω–∏—Ç–µ —Å–≤–æ—é –ø–æ–∑–∏—Ü–∏—é..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="appealProof">–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤–∞—à–µ–π –Ω–µ–≤–∏–Ω–æ–≤–Ω–æ—Å—Ç–∏:</label>
                    <textarea id="appealProof" placeholder="–°—Å—ã–ª–∫–∏ –Ω–∞ –∑–∞–ø–∏—Å—å —Å—Ç—Ä–∏–º–∞, —Å–∫—Ä–∏–Ω—à–æ—Ç—ã, —Å–≤–∏–¥–µ—Ç–µ–ª–∏ –∏ —Ç.–¥."></textarea>
                </div>
                <button class="submit-btn" onclick="submitAppeal()">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–ø–µ–ª–ª—è—Ü–∏—é</button>
            </div>
            
            <!-- –§–æ—Ä–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ -->
            <div id="supportForm" class="form-container">
                <h2 style="color: #00cc99; margin-bottom: 20px;">üí¨ –§–æ—Ä–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</h2>
                <div class="form-group">
                    <label for="supportNickname">–í–∞—à –∏–≥—Ä–æ–≤–æ–π –Ω–∏–∫:</label>
                    <input type="text" id="supportNickname" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Player123" required>
                </div>
                <div class="form-group">
                    <label for="supportCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø—Ä–æ–±–ª–µ–º—ã:</label>
                    <select id="supportCategory" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                        <option value="connection">–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º</option>
                        <option value="bug">–ë–∞–≥–∏/–≥–ª—é–∫–∏</option>
                        <option value="donate">–í–æ–ø—Ä–æ—Å—ã –ø–æ –¥–æ–Ω–∞—Ç—É</option>
                        <option value="technical">–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="supportDescription">–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:</label>
                    <textarea id="supportDescription" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É –∫–∞–∫ –º–æ–∂–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–µ–µ..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="supportProof">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</label>
                    <textarea id="supportProof" placeholder="–õ–æ–≥–∏ –æ—à–∏–±–æ–∫, —Å–∫—Ä–∏–Ω—à–æ—Ç—ã, –≤–µ—Ä—Å–∏—è –∏–≥—Ä—ã –∏ —Ç.–¥."></textarea>
                </div>
                <button class="submit-btn" onclick="submitSupport()">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É</button>
            </div>
            
            <!-- –°—Ç–∞—Ç—É—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
            <div id="statusMessage" class="status-message"></div>
            
            <!-- –ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è -->
            <div class="my-requests">
                <h2 style="color: #ffb3ff; margin-bottom: 20px;">üìã –ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è</h2>
                <div id="requestsList">
                    <p style="text-align: center; color: #aaa;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π</p>
                </div>
            </div>
        </div>
    </div>

    <script>
    // ==================== FIREBASE –ö–û–ù–§–ò–ì ====================
    const firebaseConfig = {
        apiKey: "AIzaSyBwhNixWO8dF_drN2hHVYzfTAbMCiT91Gw",
        authDomain: "jojoland-chat.firebaseapp.com",
        databaseURL: "https://jojoland-chat-default-rtdb.firebaseio.com",
        projectId: "jojoland-chat",
        storageBucket: "jojoland-chat.firebasestorage.app",
        messagingSenderId: "602788305122",
        appId: "1:602788305122:web:c03f5b5ef59c85fc9fe6bb"
    };
    
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    // ==================== –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
    let userId = localStorage.getItem('jojoland_userId');
    if (!userId) {
        userId = 'user_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('jojoland_userId', userId);
    }
    
    let username = localStorage.getItem('jojoland_username') || 
                   `–ò–≥—Ä–æ–∫_${Math.floor(Math.random() * 1000)}`;
    
    // ==================== –í–´–ë–û–† –¢–ò–ü–ê –û–ë–†–ê–©–ï–ù–ò–Ø ====================
    function selectType(type) {
        // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
        document.querySelectorAll('.type-card').forEach(card => {
            card.classList.remove('active');
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ
        document.querySelector(`[data-type="${type}"]`).classList.add('active');
        
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ñ–æ—Ä–º—ã
        document.querySelectorAll('.form-container').forEach(form => {
            form.classList.remove('active');
        });
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ñ–æ—Ä–º—É
        document.getElementById(`${type}Form`).classList.add('active');
        
        // –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å —Å–æ–æ–±—â–µ–Ω–∏—è
        document.getElementById('statusMessage').style.display = 'none';
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –Ω–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        fillNicknameFields();
    }
    
    function fillNicknameFields() {
        document.querySelectorAll('input[type="text"][id$="Nickname"]').forEach(input => {
            if (!input.value) {
                input.value = username;
            }
        });
    }
    
    // ==================== –û–¢–ü–†–ê–í–ö–ê –ñ–ê–õ–û–ë–´ ====================
    async function submitComplaint() {
        // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        const complaintData = {
            type: 'complaint',
            userNickname: document.getElementById('complaintNickname').value.trim(),
            violatorNickname: document.getElementById('violatorNickname').value.trim(),
            violationTime: document.getElementById('violationTime').value.trim(),
            description: document.getElementById('violationDescription').value.trim(),
            proof: document.getElementById('complaintProof').value.trim(),
            userId: userId,
            username: username,
            timestamp: Date.now(),
            status: 'new',
            ticketId: generateTicketId('COMP')
        };
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (!validateComplaint(complaintData)) return;
        
        try {
            await database.ref('support_tickets').push(complaintData);
            showStatus('success', '‚úÖ –ñ–∞–ª–æ–±–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞—Å—Å–º–æ—Ç—Ä–∏—Ç –µ—ë –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤.');
            clearForm('complaint');
            loadUserRequests();
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
            showStatus('error', '‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
        }
    }
    
    // ==================== –û–¢–ü–†–ê–í–ö–ê –ê–ü–ï–õ–õ–Ø–¶–ò–ò ====================
    async function submitAppeal() {
        const appealData = {
            type: 'appeal',
            userNickname: document.getElementById('appealNickname').value.trim(),
            punishmentType: document.getElementById('punishmentType').value,
            punishmentDate: document.getElementById('punishmentDate').value.trim(),
            reason: document.getElementById('appealReason').value.trim(),
            proof: document.getElementById('appealProof').value.trim(),
            userId: userId,
            username: username,
            timestamp: Date.now(),
            status: 'new',
            ticketId: generateTicketId('APL')
        };
        
        if (!validateAppeal(appealData)) return;
        
        try {
            await database.ref('support_tickets').push(appealData);
            showStatus('success', '‚úÖ –ê–ø–µ–ª–ª—è—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –†–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –æ–±—ã—á–Ω–æ –∑–∞–Ω–∏–º–∞–µ—Ç 1-3 –¥–Ω—è.');
            clearForm('appeal');
            loadUserRequests();
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
            showStatus('error', '‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
        }
    }
    
    // ==================== –û–¢–ü–†–ê–í–ö–ê –í –ü–û–î–î–ï–†–ñ–ö–£ ====================
    async function submitSupport() {
        const supportData = {
            type: 'support',
            userNickname: document.getElementById('supportNickname').value.trim(),
            category: document.getElementById('supportCategory').value,
            description: document.getElementById('supportDescription').value.trim(),
            additionalInfo: document.getElementById('supportProof').value.trim(),
            userId: userId,
            username: username,
            timestamp: Date.now(),
            status: 'new',
            ticketId: generateTicketId('SUP')
        };
        
        if (!validateSupport(supportData)) return;
        
        try {
            await database.ref('support_tickets').push(supportData);
            showStatus('success', '‚úÖ –û–±—Ä–∞—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ! –û—Ç–≤–µ—Ç–∏–º –≤ —Ç–µ—á–µ–Ω–∏–µ 12 —á–∞—Å–æ–≤.');
            clearForm('support');
            loadUserRequests();
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
            showStatus('error', '‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.');
        }
    }
    
    // ==================== –í–ê–õ–ò–î–ê–¶–ò–Ø ====================
    function validateComplaint(data) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
        if (!data.userNickname || data.userNickname.trim() === '') {
            showStatus('error', '‚ùå –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∏–≥—Ä–æ–≤–æ–π –Ω–∏–∫!');
            return false;
        }
        
        if (!data.violatorNickname || data.violatorNickname.trim() === '') {
            showStatus('error', '‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –Ω–∞—Ä—É—à–∏—Ç–µ–ª—è!');
            return false;
        }
        
        if (!data.violationTime || data.violationTime.trim() === '') {
            showStatus('error', '‚ùå –£–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è –Ω–∞—Ä—É—à–µ–Ω–∏—è!');
            return false;
        }
        
        if (!data.description || data.description.trim() === '') {
            showStatus('error', '‚ùå –û–ø–∏—à–∏—Ç–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ!');
            return false;
        }
        
        if (data.description.length < 20) {
            showStatus('error', '‚ùå –û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–º (–º–∏–Ω–∏–º—É–º 20 —Å–∏–º–≤–æ–ª–æ–≤)');
            return false;
        }
        
        return true;
    }
    
    function validateAppeal(data) {
        if (!data.userNickname || data.userNickname.trim() === '') {
            showStatus('error', '‚ùå –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∏–≥—Ä–æ–≤–æ–π –Ω–∏–∫!');
            return false;
        }
        
        if (!data.punishmentType || data.punishmentType.trim() === '') {
            showStatus('error', '‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–∞–∫–∞–∑–∞–Ω–∏—è!');
            return false;
        }
        
        if (!data.punishmentDate || data.punishmentDate.trim() === '') {
            showStatus('error', '‚ùå –£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –Ω–∞–∫–∞–∑–∞–Ω–∏—è!');
            return false;
        }
        
        if (!data.reason || data.reason.trim() === '') {
            showStatus('error', '‚ùå –û–±—ä—è—Å–Ω–∏—Ç–µ, –ø–æ—á–µ–º—É –Ω–∞–∫–∞–∑–∞–Ω–∏–µ –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ!');
            return false;
        }
        
        if (data.reason.length < 20) {
            showStatus('error', '‚ùå –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–º (–º–∏–Ω–∏–º—É–º 20 —Å–∏–º–≤–æ–ª–æ–≤)');
            return false;
        }
        
        return true;
    }
    
    function validateSupport(data) {
        if (!data.userNickname || data.userNickname.trim() === '') {
            showStatus('error', '‚ùå –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∏–≥—Ä–æ–≤–æ–π –Ω–∏–∫!');
            return false;
        }
        
        if (!data.category || data.category.trim() === '') {
            showStatus('error', '‚ùå –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø—Ä–æ–±–ª–µ–º—ã!');
            return false;
        }
        
        if (!data.description || data.description.trim() === '') {
            showStatus('error', '‚ùå –û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É!');
            return false;
        }
        
        if (data.description.length < 10) {
            showStatus('error', '‚ùå –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–º (–º–∏–Ω–∏–º—É–º 10 —Å–∏–º–≤–æ–ª–æ–≤)');
            return false;
        }
        
        return true;
    }
    
    // ==================== –ü–û–ö–ê–ó –°–¢–ê–¢–£–°–ê ====================
    function showStatus(type, message) {
        const statusDiv = document.getElementById('statusMessage');
        statusDiv.className = `status-message ${type}`;
        statusDiv.innerHTML = message;
        statusDiv.style.display = 'block';
        
        // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Å—Ç–∞—Ç—É—Å—É
        statusDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        
        setTimeout(() => {
            statusDiv.style.display = 'none';
        }, 5000);
    }
    
    // ==================== –ó–ê–ì–†–£–ó–ö–ê –û–ë–†–ê–©–ï–ù–ò–ô –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ====================
    async function loadUserRequests() {
        try {
            const snapshot = await database.ref('support_tickets')
                .orderByChild('userId')
                .equalTo(userId)
                .once('value');
            
            const requestsList = document.getElementById('requestsList');
            
            if (!snapshot.exists()) {
                requestsList.innerHTML = '<p style="text-align: center; color: #aaa;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π</p>';
                return;
            }
            
            let html = '';
            const requests = [];
            
            snapshot.forEach(childSnapshot => {
                const request = childSnapshot.val();
                // –î–æ–±–∞–≤–ª—è–µ–º ID –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                request.id = childSnapshot.key;
                requests.push(request);
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            requests.sort((a, b) => b.timestamp - a.timestamp);
            
            if (requests.length === 0) {
                requestsList.innerHTML = '<p style="text-align: center; color: #aaa;">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π</p>';
                return;
            }
            
            requests.forEach(request => {
                const date = new Date(request.timestamp);
                const dateStr = date.toLocaleDateString('ru-RU') + ' ' + 
                              date.toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'});
                
                const typeText = request.type === 'complaint' ? '–ñ–∞–ª–æ–±–∞' : 
                                request.type === 'appeal' ? '–ê–ø–µ–ª–ª—è—Ü–∏—è' : '–ü–æ–¥–¥–µ—Ä–∂–∫–∞';
                
                const typeClass = request.type === 'complaint' ? 'badge-complaint' : 
                                 request.type === 'appeal' ? 'badge-appeal' : 'badge-support';
                
                const statusText = request.status === 'new' ? 'üÜï –ù–æ–≤–æ–µ' : 
                                  request.status === 'read' ? 'üëÅÔ∏è –ü—Ä–æ—á–∏—Ç–∞–Ω–æ' : 
                                  request.status === 'answered' ? 'üì® –û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω' : '‚úÖ –ó–∞–∫—Ä—ã—Ç–æ';
                
                const statusClass = request.status === 'new' ? 'status-new' : 
                                   request.status === 'read' ? 'status-read' : 'status-closed';
                
                // –¢–µ–∫—Å—Ç –æ–±—Ä–∞—â–µ–Ω–∏—è
                const requestText = request.description || request.reason || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è';
                
                html += `
                    <div class="request-item ${request.type}">
                        <div class="request-header">
                            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                                <span class="request-type-badge ${typeClass}">${typeText}</span>
                                <strong style="color: #6ab7ff;">${request.ticketId || request.id}</strong>
                            </div>
                            <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                                <span class="request-status ${statusClass}">${statusText}</span>
                                <small style="color: #aaa; font-size: 12px;">${dateStr}</small>
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <p style="color: #ccccff; line-height: 1.5; word-break: break-word;">
                                ${truncateText(requestText, 150)}
                            </p>
                            ${request.adminAnswer ? `
                                <div style="margin-top: 15px; padding: 12px; background: rgba(0,255,0,0.1); border-radius: 10px; border-left: 3px solid #00ff00;">
                                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                                        <span style="color: #00ff00; font-weight: bold;">üì® –û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏</span>
                                        <small style="color: #aaa;">
                                            ${request.adminName || '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä'}
                                        </small>
                                    </div>
                                    <p style="color: #ccffcc; line-height: 1.5; word-break: break-word;">
                                        ${request.adminAnswer}
                                    </p>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            requestsList.innerHTML = html;
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π:', error);
            document.getElementById('requestsList').innerHTML = 
                '<p style="text-align: center; color: #ff6666;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>';
        }
    }
    
    // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
    function generateTicketId(prefix) {
        const random = Math.random().toString(36).substr(2, 6).toUpperCase();
        const date = new Date();
        const dateStr = date.getDate().toString().padStart(2, '0') + 
                      (date.getMonth() + 1).toString().padStart(2, '0') + 
                      date.getFullYear().toString().substr(2, 2);
        return `${prefix}-${dateStr}-${random}`;
    }
    
    function truncateText(text, maxLength) {
        if (!text) return '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è';
        if (text.length <= maxLength) return text;
        return text.substr(0, maxLength) + '...';
    }
    
    function clearForm(type) {
        const form = document.getElementById(`${type}Form`);
        form.querySelectorAll('input:not([id$="Nickname"]), textarea, select').forEach(element => {
            element.value = '';
        });
    }
    
    // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
    document.addEventListener('DOMContentLoaded', () => {
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º –Ω–∏–∫ –≤–æ –≤—Å–µ—Ö —Ñ–æ—Ä–º–∞—Ö
        fillNicknameFields();
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±—Ä–∞—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        loadUserRequests();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∏–∫ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
        document.querySelectorAll('input[type="text"][id$="Nickname"]').forEach(input => {
            input.value = username;
        });
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∏–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
        document.querySelectorAll('input[type="text"][id$="Nickname"]').forEach(input => {
            input.addEventListener('change', function() {
                const newUsername = this.value.trim();
                if (newUsername) {
                    username = newUsername;
                    localStorage.setItem('jojoland_username', username);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–æ –≤—Å–µ—Ö –ø–æ–ª—è—Ö
                    document.querySelectorAll('input[type="text"][id$="Nickname"]').forEach(field => {
                        field.value = username;
                    });
                }
            });
        });
        
        // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—É—é —Ñ–æ—Ä–º—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        selectType('complaint');
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Å–±—Ä–æ—Å–∞ –Ω–∏–∫–Ω–µ–π–º–∞
        addResetUsernameButton();
    });
    
    function addResetUsernameButton() {
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≤ –∫–∞–∂–¥—É—é —Ñ–æ—Ä–º—É
        const forms = ['complaint', 'appeal', 'support'];
        forms.forEach(type => {
            const form = document.getElementById(`${type}Form`);
            const nicknameField = form.querySelector('input[type="text"][id$="Nickname"]');
            
            if (nicknameField) {
                const resetBtn = document.createElement('button');
                resetBtn.type = 'button';
                resetBtn.textContent = 'üîÑ –°–±—Ä–æ—Å–∏—Ç—å';
                resetBtn.style.cssText = `
                    margin-left: 10px;
                    padding: 5px 10px;
                    background: rgba(255,255,255,0.1);
                    border: 1px solid rgba(255,255,255,0.3);
                    border-radius: 10px;
                    color: #ffb3ff;
                    cursor: pointer;
                    font-size: 12px;
                `;
                resetBtn.onclick = function() {
                    const newUsername = `–ò–≥—Ä–æ–∫_${Math.floor(Math.random() * 1000)}`;
                    username = newUsername;
                    localStorage.setItem('jojoland_username', newUsername);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–æ –≤—Å–µ—Ö –ø–æ–ª—è—Ö
                    document.querySelectorAll('input[type="text"][id$="Nickname"]').forEach(field => {
                        field.value = newUsername;
                    });
                    
                    alert(`–ù–∏–∫–Ω–µ–π–º —Å–±—Ä–æ—à–µ–Ω –Ω–∞: ${newUsername}`);
                };
                
                nicknameField.parentNode.appendChild(resetBtn);
            }
        });
    }
</script>
</body>
</html>
