<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä–∞—Å–Ω–æ–µ –∏–ª–∏ –ß–µ—Ä–Ω–æ–µ | –ö–∞–∑–∏–Ω–æ JojoLand</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="casino.css">
    <link rel="stylesheet" href="game.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Michroma&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

<div id="loader">
    <div class="spinner"></div>
    <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
</div>

<div class="background-effects" id="particles"></div>

<div id="content">
    <header>
        <div class="header-top">
            <a href="casino.html" class="profile-btn">
                <span class="profile-icon">üé∞</span>
                <span class="profile-text">–í –∫–∞–∑–∏–Ω–æ</span>
            </a>
            <a href="index.html" class="profile-btn">
                <span class="profile-icon">üè†</span>
                <span class="profile-text">–ù–∞ –≥–ª–∞–≤–Ω—É—é</span>
            </a>
            <img src="images/logo.png" class="logo" alt="JojoLand Logo">
        </div>
        
        <h1>üéØ –ö—Ä–∞—Å–Ω–æ–µ –∏–ª–∏ –ß–µ—Ä–Ω–æ–µ</h1>
        <p class="subtitle">–£–≥–∞–¥–∞–π —Ü–≤–µ—Ç –∏ –≤—ã–∏–≥—Ä–∞–π —Ö2!</p>
    </header>

    <div class="game-container">
        <!-- –ò–ù–§–û –ò–ì–†–´ -->
        <div class="game-info-section">
            <div class="game-rules">
                <h2>üéØ –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h2>
                <ul>
                    <li>–°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É –æ—Ç 10 –¥–æ 1000 –æ—á–∫–æ–≤</li>
                    <li>–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç: –ö—Ä–∞—Å–Ω–æ–µ –∏–ª–∏ –ß–µ—Ä–Ω–æ–µ</li>
                    <li>–®–∞–Ω—Å –≤—ã–∏–≥—Ä—ã—à–∞: 50%</li>
                    <li>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤—ã–∏–≥—Ä—ã—à–∞: x2</li>
                    <li>–ï—Å–ª–∏ —É–≥–∞–¥–∞–µ—Ç–µ —Ü–≤–µ—Ç - –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç–µ —É–¥–≤–æ–µ–Ω–Ω—É—é —Å—Ç–∞–≤–∫—É!</li>
                </ul>
            </div>
            
            <div class="game-balance">
                <div class="balance-card">
                    <div class="balance-icon">üí∞</div>
                    <div class="balance-info">
                        <h3>–í–∞—à –±–∞–ª–∞–Ω—Å</h3>
                        <div class="balance-amount" id="user-balance">0</div>
                        <p class="balance-label">–Ω–æ–≤–æ–≥–æ–¥–Ω–∏—Ö –æ—á–∫–æ–≤</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°–¢–ê–í–ö–ê -->
        <div class="bet-section">
            <h2>üí∞ –°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É</h2>
            
            <div class="bet-amount">
                <div class="bet-slider">
                    <input type="range" id="bet-slider" min="10" max="1000" step="10" value="100">
                    <div class="slider-values">
                        <span>10</span>
                        <span>1000</span>
                    </div>
                </div>
                
                <div class="bet-input">
                    <label for="bet-input">–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏:</label>
                    <div class="input-group">
                        <input type="number" id="bet-input" min="10" max="1000" value="100">
                        <span class="input-suffix">–æ—á–∫–æ–≤</span>
                    </div>
                    <div class="bet-buttons">
                        <button class="quick-bet" data-amount="10">10</button>
                        <button class="quick-bet" data-amount="50">50</button>
                        <button class="quick-bet" data-amount="100">100</button>
                        <button class="quick-bet" data-amount="500">500</button>
                        <button class="quick-bet" data-amount="1000">1000</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –í–´–ë–û–† –¶–í–ï–¢–ê -->
        <div class="choice-section">
            <h2>üé® –í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç</h2>
            
            <div class="color-choices">
                <div class="color-choice" data-color="red">
                    <div class="color-display red"></div>
                    <div class="color-info">
                        <h3>–ö—Ä–∞—Å–Ω–æ–µ</h3>
                        <p>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: x2</p>
                    </div>
                    <div class="color-stats">
                        <div class="stat">–®–∞–Ω—Å: 50%</div>
                        <div class="stat">–í—ã–∏–≥—Ä—ã—à: <span id="red-win">200</span></div>
                    </div>
                </div>
                
                <div class="color-choice" data-color="black">
                    <div class="color-display black"></div>
                    <div class="color-info">
                        <h3>–ß–µ—Ä–Ω–æ–µ</h3>
                        <p>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç: x2</p>
                    </div>
                    <div class="color-stats">
                        <div class="stat">–®–∞–Ω—Å: 50%</div>
                        <div class="stat">–í—ã–∏–≥—Ä—ã—à: <span id="black-win">200</span></div>
                    </div>
                </div>
            </div>
            
            <div class="selected-choice" id="selected-choice" style="display: none;">
                <h3>–í–∞—à –≤—ã–±–æ—Ä:</h3>
                <div class="selected-display">
                    <div class="selected-color" id="selected-color"></div>
                    <span id="selected-color-name">–ö—Ä–∞—Å–Ω–æ–µ</span>
                </div>
            </div>
        </div>

        <!-- –ö–ù–û–ü–ö–ê –ò–ì–†–´ -->
        <div class="play-section">
            <button class="play-btn" id="play-btn" disabled>
                üéØ –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É
            </button>
            <p class="play-note">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: 10 –æ—á–∫–æ–≤</p>
        </div>

        <!-- –ò–°–¢–û–†–ò–Ø -->
        <div class="history-section">
            <h2>üìú –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä—ã</h2>
            <div class="history-list" id="game-history">
                <!-- –ò—Å—Ç–æ—Ä–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                <div class="empty-history">
                    <div class="empty-icon">üé∞</div>
                    <p>–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–≥—Ä</p>
                    <small>–°–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–≤—É—é —Å—Ç–∞–≤–∫—É!</small>
                </div>
            </div>
        </div>

        <!-- –ö–ù–û–ü–ö–ò -->
        <div class="action-buttons">
            <button class="action-btn" id="back-btn">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
            <button class="action-btn" id="create-game-btn">üéÆ –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É</button>
            <button class="action-btn" id="join-game-btn">ü§ù –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
        </div>
    </div>
</div>

<!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ò–ì–†–´ -->
<div id="game-modal" class="modal-overlay">
    <div class="modal-content game-modal">
        <div class="game-header">
            <h2>üé∞ –ò–≥—Ä–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ</h2>
            <p id="game-status">–û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤...</p>
        </div>
        
        <div class="game-body">
            <div class="game-info">
                <div class="info-item">
                    <span class="info-label">–°—Ç–∞–≤–∫–∞:</span>
                    <span class="info-value" id="modal-bet">100</span>
                </div>
                <div class="info-item">
                    <span class="info-label">–ò–≥—Ä–æ–∫–æ–≤:</span>
                    <span class="info-value" id="modal-players">1/2</span>
                </div>
                <div class="info-item">
                    <span class="info-label">–í–∞—à –≤—ã–±–æ—Ä:</span>
                    <span class="info-value" id="modal-choice">–ö—Ä–∞—Å–Ω–æ–µ</span>
                </div>
            </div>
            
            <div class="game-wheel" id="game-wheel">
                <div class="wheel-container">
                    <div class="wheel" id="wheel">
                        <div class="wheel-section red"></div>
                        <div class="wheel-section black"></div>
                        <div class="wheel-section red"></div>
                        <div class="wheel-section black"></div>
                        <div class="wheel-section red"></div>
                        <div class="wheel-section black"></div>
                        <div class="wheel-center"></div>
                    </div>
                    <div class="wheel-pointer"></div>
                </div>
            </div>
            
            <div class="game-result" id="game-result" style="display: none;">
                <div class="result-title" id="result-title">–†–µ–∑—É–ª—å—Ç–∞—Ç:</div>
                <div class="result-color" id="result-color"></div>
                <div class="result-message" id="result-message"></div>
                <div class="result-amount" id="result-amount"></div>
            </div>
        </div>
        
        <div class="game-footer">
            <button class="close-btn" id="close-game">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
const firebaseConfig = {
    apiKey: "AIzaSyBwhNixWO8dF_drN2hHVYzfTAbMCiT91Gw",
    authDomain: "jojoland-chat.firebasestorage.app",
    databaseURL: "https://jojoland-chat-default-rtdb.firebaseio.com",
    projectId: "jojoland-chat",
    storageBucket: "jojoland-chat.firebasestorage.app",
    messagingSenderId: "602788305122",
    appId: "1:602788305122:web:c03f5b5ef59c85fc9fe6bb"
};

if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}
const database = firebase.database();

let userId = null;
let userNickname = null;
let userBalance = 0;
let selectedColor = null;
let currentBet = 100;
let currentGameId = null;

window.onload = async function() {
    if (await checkAuth()) {
        await loadUserBalance();
        setupEventListeners();
        updateWinAmounts();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–≥—Ä—ã –≤ URL
        const urlParams = new URLSearchParams(window.location.search);
        const gameId = urlParams.get('game');
        if (gameId) {
            await joinExistingGame(gameId);
        }
    }
};

async function checkAuth() {
    userId = localStorage.getItem('jojoland_userId');
    userNickname = localStorage.getItem('jojoland_nickname');
    
    if (!userId || !userNickname) {
        alert('–î–ª—è –∏–≥—Ä—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç');
        window.location.href = 'index.html';
        return false;
    }
    return true;
}

async function loadUserBalance() {
    try {
        const snapshot = await database.ref('holiday_points/' + userId).once('value');
        if (snapshot.exists()) {
            const pointsData = snapshot.val();
            userBalance = pointsData.available_points || 0;
            document.getElementById('user-balance').textContent = userBalance;
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–ª–∞–Ω—Å–∞:', error);
    }
}

function setupEventListeners() {
    // –°–ª–∞–π–¥–µ—Ä —Å—Ç–∞–≤–∫–∏
    const betSlider = document.getElementById('bet-slider');
    const betInput = document.getElementById('bet-input');
    
    betSlider.addEventListener('input', function() {
        currentBet = parseInt(this.value);
        betInput.value = currentBet;
        updateWinAmounts();
        checkPlayButton();
    });
    
    betInput.addEventListener('input', function() {
        let value = parseInt(this.value) || 10;
        value = Math.min(Math.max(value, 10), 1000);
        currentBet = value;
        betSlider.value = value;
        this.value = value;
        updateWinAmounts();
        checkPlayButton();
    });
    
    // –ë—ã—Å—Ç—Ä—ã–µ —Å—Ç–∞–≤–∫–∏
    document.querySelectorAll('.quick-bet').forEach(btn => {
        btn.addEventListener('click', function() {
            currentBet = parseInt(this.getAttribute('data-amount'));
            betSlider.value = currentBet;
            betInput.value = currentBet;
            updateWinAmounts();
            checkPlayButton();
        });
    });
    
    // –í—ã–±–æ—Ä —Ü–≤–µ—Ç–∞
    document.querySelectorAll('.color-choice').forEach(choice => {
        choice.addEventListener('click', function() {
            selectedColor = this.getAttribute('data-color');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
            document.querySelectorAll('.color-choice').forEach(c => {
                c.classList.remove('selected');
            });
            
            // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π
            this.classList.add('selected');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ü–≤–µ—Ç
            const selectedDisplay = document.getElementById('selected-choice');
            const selectedColorEl = document.getElementById('selected-color');
            const selectedName = document.getElementById('selected-color-name');
            
            selectedDisplay.style.display = 'block';
            selectedColorEl.className = `selected-color ${selectedColor}`;
            selectedName.textContent = selectedColor === 'red' ? '–ö—Ä–∞—Å–Ω–æ–µ' : '–ß–µ—Ä–Ω–æ–µ';
            
            checkPlayButton();
        });
    });
    
    // –ö–Ω–æ–ø–∫–∞ –∏–≥—Ä—ã
    document.getElementById('play-btn').addEventListener('click', createGame);
    
    // –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä—ã
    document.getElementById('create-game-btn').addEventListener('click', createGame);
    
    // –ö–Ω–æ–ø–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    document.getElementById('join-game-btn').addEventListener('click', function() {
        window.location.href = 'casino.html';
    });
    
    // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
    document.getElementById('back-btn').addEventListener('click', function() {
        window.location.href = 'casino.html';
    });
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    document.getElementById('close-game').addEventListener('click', function() {
        document.getElementById('game-modal').style.display = 'none';
        if (currentGameId) {
            // –ü–æ–∫–∏–¥–∞–µ–º –∏–≥—Ä—É –µ—Å–ª–∏ –æ–Ω–∞ –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å
            leaveGame();
        }
    });
}

function updateWinAmounts() {
    const winAmount = currentBet * 2;
    document.getElementById('red-win').textContent = winAmount;
    document.getElementById('black-win').textContent = winAmount;
}

function checkPlayButton() {
    const playBtn = document.getElementById('play-btn');
    const canPlay = selectedColor && currentBet >= 10 && currentBet <= userBalance;
    
    playBtn.disabled = !canPlay;
    
    if (!canPlay) {
        if (!selectedColor) {
            playBtn.innerHTML = 'üéØ –í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç';
        } else if (currentBet > userBalance) {
            playBtn.innerHTML = `üí∏ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤`;
        } else {
            playBtn.innerHTML = 'üéØ –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É';
        }
    } else {
        playBtn.innerHTML = `üéØ –ü–æ—Å—Ç–∞–≤–∏—Ç—å ${currentBet} –æ—á–∫–æ–≤`;
    }
}

async function createGame() {
    if (!selectedColor || currentBet < 10 || currentBet > userBalance) {
        showError('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞–≤–∫—É –∏ –≤—ã–±–æ—Ä —Ü–≤–µ—Ç–∞');
        return;
    }
    
    try {
        // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
        const pointsSnapshot = await database.ref('holiday_points/' + userId).once('value');
        if (pointsSnapshot.exists()) {
            const pointsData = pointsSnapshot.val();
            const newBalance = (pointsData.available_points || 0) - currentBet;
            
            await database.ref('holiday_points/' + userId).update({
                available_points: newBalance
            });
            
            userBalance = newBalance;
            document.getElementById('user-balance').textContent = userBalance;
        }
        
        // –°–æ–∑–¥–∞–µ–º –∏–≥—Ä—É
        const gameId = 'red_black_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        currentGameId = gameId;
        
        const gameData = {
            game_type: 'red_black',
            created_by: userId,
            creator_nickname: userNickname,
            bet: currentBet,
            created_at: new Date().toISOString(),
            status: 'waiting',
            max_players: 2,
            players: {
                [userId]: {
                    nickname: userNickname,
                    choice: selectedColor,
                    joined_at: new Date().toISOString(),
                    result: null
                }
            },
            result: null,
            winner: null
        };
        
        await database.ref('casino_games/' + gameId).set(gameData);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–≥—Ä—ã
        showGameModal(gameData);
        
        // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–≥—Ä—ã
        database.ref('casino_games/' + gameId).on('value', async (snapshot) => {
            if (snapshot.exists()) {
                const updatedGame = snapshot.val();
                updateGameModal(updatedGame);
                
                // –ï—Å–ª–∏ –∏–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                if (updatedGame.status === 'finished' && updatedGame.result) {
                    await processGameResult(updatedGame);
                }
            }
        });
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä—ã:', error);
        showError('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–≥—Ä—ã');
    }
}

async function joinExistingGame(gameId) {
    try {
        const gameSnapshot = await database.ref('casino_games/' + gameId).once('value');
        
        if (!gameSnapshot.exists()) {
            showError('–ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            return;
        }
        
        const game = gameSnapshot.val();
        currentGameId = gameId;
        
        // –ï—Å–ª–∏ –∏–≥—Ä–∞ —É–∂–µ –Ω–∞—á–∞–ª–∞—Å—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        if (game.status === 'finished') {
            await processGameResult(game);
            return;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–≥—Ä—ã
        showGameModal(game);
        
        // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        database.ref('casino_games/' + gameId).on('value', async (snapshot) => {
            if (snapshot.exists()) {
                const updatedGame = snapshot.val();
                updateGameModal(updatedGame);
                
                if (updatedGame.status === 'finished' && updatedGame.result) {
                    await processGameResult(updatedGame);
                }
            }
        });
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∏–≥—Ä–µ:', error);
        showError('–û—à–∏–±–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∏–≥—Ä–µ');
    }
}

function showGameModal(gameData) {
    const modal = document.getElementById('game-modal');
    document.getElementById('modal-bet').textContent = gameData.bet;
    document.getElementById('modal-choice').textContent = 
        gameData.players[userId]?.choice === 'red' ? '–ö—Ä–∞—Å–Ω–æ–µ' : '–ß–µ—Ä–Ω–æ–µ';
    
    const playersCount = Object.keys(gameData.players || {}).length;
    document.getElementById('modal-players').textContent = `${playersCount}/${gameData.max_players}`;
    
    modal.style.display = 'flex';
}

function updateGameModal(gameData) {
    const playersCount = Object.keys(gameData.players || {}).length;
    document.getElementById('modal-players').textContent = `${playersCount}/${gameData.max_players}`;
    
    if (gameData.status === 'in_progress') {
        document.getElementById('game-status').textContent = '–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!';
        startWheelAnimation(gameData.result);
    } else if (gameData.status === 'finished') {
        document.getElementById('game-status').textContent = '–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
    }
}

async function startWheelAnimation(result) {
    const wheel = document.getElementById('wheel');
    const resultDiv = document.getElementById('game-result');
    const resultColor = document.getElementById('result-color');
    const resultMessage = document.getElementById('result-message');
    const resultAmount = document.getElementById('result-amount');
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
    wheel.style.transition = 'transform 3s cubic-bezier(0.1, 0.7, 0.1, 1)';
    
    // –í—Ä–∞—â–∞–µ–º –∫–æ–ª–µ—Å–æ (2 –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–∞ + —É–≥–æ–ª –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞)
    const rotations = 2;
    const redAngle = 60; // –ö—Ä–∞—Å–Ω–æ–µ –Ω–∞ 60 –≥—Ä–∞–¥—É—Å–æ–≤
    const blackAngle = 240; // –ß–µ—Ä–Ω–æ–µ –Ω–∞ 240 –≥—Ä–∞–¥—É—Å–æ–≤
    
    const finalAngle = result === 'red' ? 
        rotations * 360 + redAngle : 
        rotations * 360 + blackAngle;
    
    wheel.style.transform = `rotate(${finalAngle}deg)`;
    
    // –ü–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    setTimeout(() => {
        wheel.style.transition = 'none';
        
        resultDiv.style.display = 'block';
        resultColor.className = `result-color ${result}`;
        
        if (result === 'red') {
            resultMessage.textContent = '–í—ã–ø–∞–ª–æ: –ö—Ä–∞—Å–Ω–æ–µ';
        } else {
            resultMessage.textContent = '–í—ã–ø–∞–ª–æ: –ß–µ—Ä–Ω–æ–µ';
        }
        
        // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const gameRef = database.ref('casino_games/' + currentGameId);
        gameRef.once('value').then(snapshot => {
            const game = snapshot.val();
            const playerData = game.players[userId];
            
            if (playerData && playerData.result) {
                if (playerData.result === 'win') {
                    resultAmount.textContent = `+${game.bet * 2} –æ—á–∫–æ–≤`;
                    resultAmount.style.color = '#00ff00';
                } else {
                    resultAmount.textContent = `-${game.bet} –æ—á–∫–æ–≤`;
                    resultAmount.style.color = '#ff4444';
                }
            }
        });
        
    }, 3000);
}

async function processGameResult(game) {
    const playerData = game.players[userId];
    
    if (!playerData) return;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ç–æ—Ä–∏—é
    const historyData = {
        game_type: 'red_black',
        bet: game.bet,
        choice: playerData.choice === 'red' ? '–ö—Ä–∞—Å–Ω–æ–µ' : '–ß–µ—Ä–Ω–æ–µ',
        result: playerData.result,
        win_amount: playerData.result === 'win' ? game.bet * 2 : 0,
        opponent: Object.keys(game.players).find(id => id !== userId),
        timestamp: new Date().toISOString()
    };
    
    await database.ref('casino_history/' + userId + '/' + currentGameId).set(historyData);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å –µ—Å–ª–∏ –≤—ã–∏–≥—Ä–∞–ª–∏
    if (playerData.result === 'win') {
        await loadUserBalance();
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    addToGameHistory(historyData);
}

function addToGameHistory(history) {
    const historyList = document.getElementById('game-history');
    
    const historyItem = document.createElement('div');
    historyItem.className = `history-item ${history.result}`;
    
    historyItem.innerHTML = `
        <div class="history-game">
            <div class="game-type-icon">üéØ</div>
            <div class="game-info">
                <div class="game-name">${history.choice}</div>
                <div class="game-time">${new Date(history.timestamp).toLocaleTimeString('ru-RU')}</div>
            </div>
        </div>
        <div class="history-result">
            <div class="result-icon">${history.result === 'win' ? 'üí∞' : 'üí∏'}</div>
            <div class="result-text">
                <div class="result-title">${history.result === 'win' ? '–í—ã–∏–≥—Ä—ã—à' : '–ü—Ä–æ–∏–≥—Ä—ã—à'}</div>
                <div class="result-amount ${history.result}">
                    ${history.result === 'win' ? '+' : '-'}${history.bet} –æ—á–∫–æ–≤
                </div>
            </div>
        </div>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
    if (historyList.firstChild) {
        historyList.insertBefore(historyItem, historyList.firstChild);
    } else {
        historyList.innerHTML = '';
        historyList.appendChild(historyItem);
    }
}

async function leaveGame() {
    if (!currentGameId) return;
    
    try {
        const gameRef = database.ref('casino_games/' + currentGameId);
        const snapshot = await gameRef.once('value');
        const game = snapshot.val();
        
        // –ï—Å–ª–∏ –∏–≥—Ä–∞ –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–≤–∫—É
        if (game.status === 'waiting') {
            const pointsSnapshot = await database.ref('holiday_points/' + userId).once('value');
            if (pointsSnapshot.exists()) {
                const pointsData = pointsSnapshot.val();
                const newBalance = (pointsData.available_points || 0) + currentBet;
                
                await database.ref('holiday_points/' + userId).update({
                    available_points: newBalance
                });
                
                userBalance = newBalance;
                document.getElementById('user-balance').textContent = userBalance;
            }
            
            // –£–¥–∞–ª—è–µ–º –∏–≥—Ä–æ–∫–∞ –∏–∑ –∏–≥—Ä—ã
            delete game.players[userId];
            await gameRef.update({ players: game.players });
            
            // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫–æ–≤ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å, —É–¥–∞–ª—è–µ–º –∏–≥—Ä—É
            if (Object.keys(game.players).length === 0) {
                await gameRef.remove();
            }
        }
        
        currentGameId = null;
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ –∏–≥—Ä—ã:', error);
    }
}

function showError(message) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'notification error';
    errorDiv.textContent = message;
    
    document.body.appendChild(errorDiv);
    
    setTimeout(() => {
        errorDiv.remove();
    }, 3000);
}
</script>

</body>
</html>
