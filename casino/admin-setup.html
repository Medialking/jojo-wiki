<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–¥–º–∏–Ω–æ–≤ | JojoLand</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #0a0a2a, #1a1a3a);
            color: white;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 2px solid #00ff00;
        }
        
        h1 { color: #00ff00; margin-bottom: 10px; }
        p { color: #aaaaff; }
        
        .setup-form {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            padding: 30px;
            border: 3px solid #ff00ff;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #aaaaff;
            font-size: 16px;
            cursor: pointer;
            position: relative;
        }
        
        .tab.active {
            color: #00ff00;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #00ff00;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            color: #aaaaff;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            outline: none;
        }
        
        input:focus, select:focus {
            border-color: #00ff00;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
        }
        
        .btn {
            padding: 15px 30px;
            background: linear-gradient(90deg, #00cc66, #00ff88);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 204, 102, 0.5);
        }
        
        .btn-secondary {
            background: linear-gradient(90deg, #6200ff, #ff00ff);
        }
        
        .btn-danger {
            background: linear-gradient(90deg, #ff4444, #ff8888);
        }
        
        .btn-warning {
            background: linear-gradient(90deg, #ff9900, #ffcc00);
        }
        
        .results {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-entry {
            padding: 10px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        
        .success { color: #00ff00; }
        .error { color: #ff4444; }
        .info { color: #0088ff; }
        .warning { color: #ffcc00; }
        
        .admin-list {
            margin-top: 20px;
        }
        
        .admin-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-info {
            flex: 1;
        }
        
        .admin-email {
            font-weight: bold;
            color: #ffcc00;
        }
        
        .admin-name {
            color: #aaaaff;
            font-size: 14px;
        }
        
        .admin-status {
            font-size: 12px;
            padding: 3px 8px;
            border-radius: 10px;
            margin-left: 10px;
        }
        
        .status-active {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
        }
        
        .status-inactive {
            background: rgba(255, 0, 0, 0.2);
            color: #ff4444;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–¥–º–∏–Ω–æ–≤ JojoLand</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏ —Å–∏—Å—Ç–µ–º—ã</p>
        </div>
        
        <div class="setup-form">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('create')">üëë –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∞</button>
                <button class="tab" onclick="switchTab('manage')">üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞–º–∏</button>
                <button class="tab" onclick="switchTab('test')">üîê –¢–µ—Å—Ç –≤—Ö–æ–¥–∞</button>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞ -->
            <div id="tab-create" class="tab-content active">
                <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∞</h2>
                <p style="color: #ffcc00; margin-bottom: 20px;">
                    ‚ö†Ô∏è –ï—Å–ª–∏ –∞–¥–º–∏–Ω —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ–Ω –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                </p>
                
                <div class="input-group">
                    <label for="admin-email">Email –∞–¥–º–∏–Ω–∞:</label>
                    <input type="email" id="admin-email" placeholder="admin@jojoland.com" autocomplete="off">
                </div>
                
                <div class="input-group">
                    <label for="admin-password">–ü–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤):</label>
                    <input type="password" id="admin-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="off">
                </div>
                
                <div class="input-group">
                    <label for="admin-display-name">–ò–º—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                    <input type="text" id="admin-display-name" placeholder="–ì–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä" autocomplete="off">
                </div>
                
                <div class="input-group">
                    <label for="admin-level">–£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞:</label>
                    <select id="admin-level">
                        <option value="super_admin">üëë –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø)</option>
                        <option value="admin">üîß –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                        <option value="moderator">üëÅÔ∏è –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä)</option>
                    </select>
                </div>
                
                <button class="btn" onclick="createAdmin()">üëë –°–æ–∑–¥–∞—Ç—å/–ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∞</button>
                <button class="btn btn-secondary" onclick="resetForm()">üîÑ –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É</button>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞–º–∏ -->
            <div id="tab-manage" class="tab-content">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏</h2>
                
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="btn btn-secondary" onclick="loadAdmins()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
                    <button class="btn btn-warning" onclick="exportAdmins()">üì• –≠–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞</button>
                </div>
                
                <div class="admin-list" id="admin-list">
                    <div style="text-align: center; padding: 40px; color: #8888ff;">
                        –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤...
                    </div>
                </div>
            </div>
            
            <!-- –í–∫–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
            <div id="tab-test" class="tab-content">
                <h2>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–∞</h2>
                
                <div class="input-group">
                    <label for="test-email">Email –¥–ª—è —Ç–µ—Å—Ç–∞:</label>
                    <input type="email" id="test-email" placeholder="admin@jojoland.com" autocomplete="off">
                </div>
                
                <div class="input-group">
                    <label for="test-password">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="test-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="off">
                </div>
                
                <button class="btn" onclick="testLogin()">üîê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥</button>
                <button class="btn btn-secondary" onclick="testAdminPanel()">üé∞ –¢–µ—Å—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</button>
            </div>
            
            <div class="results" id="results">
                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBwhNixWO8dF_drN2hHVYzfTAbMCiT91Gw",
            authDomain: "jojoland-chat.firebasestorage.app",
            databaseURL: "https://jojoland-chat-default-rtdb.firebaseio.com",
            projectId: "jojoland-chat",
            storageBucket: "jojoland-chat.firebasestorage.app",
            messagingSenderId: "602788305122",
            appId: "1:602788305122:web:c03f5b5ef59c85fc9fe6bb"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        const auth = firebase.auth();
        const database = firebase.database();
        
        let currentTab = 'create';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function() {
            loadAdmins();
        };
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            currentTab = tabName;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(entry);
            results.scrollTop = results.scrollHeight;
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∞ (—Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ email)
        async function createAdmin() {
            const email = document.getElementById('admin-email').value.trim();
            const password = document.getElementById('admin-password').value;
            const displayName = document.getElementById('admin-display-name').value.trim();
            const level = document.getElementById('admin-level').value;
            
            if (!email || !password || password.length < 6) {
                log('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è (–ø–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)', 'error');
                return;
            }
            
            try {
                log(`üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è ${email}...`, 'info');
                
                let user;
                
                try {
                    // –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    user = userCredential.user;
                    log(`‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${email}`, 'success');
                    
                } catch (createError) {
                    if (createError.code === 'auth/email-already-in-use') {
                        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –∞–≤—Ç–æ—Ä–∏–∑—É–µ–º—Å—è
                        log(`‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${email} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∞–≤—Ç–æ—Ä–∏–∑—É–µ–º—Å—è...`, 'info');
                        
                        const signInCredential = await auth.signInWithEmailAndPassword(email, password);
                        user = signInCredential.user;
                        log(`‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${email}`, 'success');
                    } else {
                        // –î—Ä—É–≥–∞—è –æ—à–∏–±–∫–∞
                        throw createError;
                    }
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ñ–∏–ª—å
                if (displayName) {
                    await user.updateProfile({
                        displayName: displayName
                    });
                    log(`üìù –û–±–Ω–æ–≤–ª–µ–Ω–æ –∏–º—è: ${displayName}`, 'success');
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º/–æ–±–Ω–æ–≤–ª—è–µ–º –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
                const adminData = {
                    email: email,
                    displayName: displayName || '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                    level: level,
                    updatedAt: new Date().toISOString(),
                    active: true
                };
                
                await database.ref(`admins/${user.uid}`).set(adminData);
                log(`üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±–∞–∑—É (–£—Ä–æ–≤–µ–Ω—å: ${getLevelName(level)})`, 'success');
                
                // –î–æ–±–∞–≤–ª—è–µ–º email –≤ —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤ (–±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
                await addAdminEmail(email);
                
                log(`üéâ –ê–¥–º–∏–Ω ${email} —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!`, 'success');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤
                await loadAdmins();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–¥–º–∏–Ω–∞:', error);
                log(`‚ùå –û—à–∏–±–∫–∞: ${getErrorMessage(error)}`, 'error');
            }
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ email –≤ —Å–ø–∏—Å–æ–∫ (–±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
        async function addAdminEmail(email) {
            try {
                const emailLower = email.toLowerCase();
                const snapshot = await database.ref('admin_emails').once('value');
                const emails = snapshot.val() || {};
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π email
                const emailExists = Object.values(emails).some(existingEmail => 
                    existingEmail.toLowerCase() === emailLower
                );
                
                if (!emailExists) {
                    await database.ref('admin_emails').push(emailLower);
                    log(`üìß Email –¥–æ–±–∞–≤–ª–µ–Ω –≤ —Å–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤`, 'info');
                } else {
                    log(`üìß Email —É–∂–µ –µ—Å—Ç—å –≤ —Å–ø–∏—Å–∫–µ –∞–¥–º–∏–Ω–æ–≤`, 'info');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è email:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–æ–≤
        async function loadAdmins() {
            try {
                const adminList = document.getElementById('admin-list');
                adminList.innerHTML = '<div style="text-align: center; padding: 20px; color: #8888ff;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
                
                const snapshot = await database.ref('admins').once('value');
                const admins = snapshot.val();
                
                if (!admins || Object.keys(admins).length === 0) {
                    adminList.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #ffcc00;">
                            üì≠ –ê–¥–º–∏–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                for (const [uid, adminData] of Object.entries(admins)) {
                    const statusClass = adminData.active ? 'status-active' : 'status-inactive';
                    const statusText = adminData.active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω';
                    
                    html += `
                        <div class="admin-item">
                            <div class="admin-info">
                                <div class="admin-email">${adminData.email}</div>
                                <div class="admin-name">${adminData.displayName || '–ë–µ–∑ –∏–º–µ–Ω–∏'} 
                                    <span class="admin-status ${statusClass}">${statusText}</span>
                                </div>
                                <div style="font-size: 12px; color: #8888ff; margin-top: 5px;">
                                    –£—Ä–æ–≤–µ–Ω—å: ${getLevelName(adminData.level)} | UID: ${uid.substring(0, 8)}...
                                </div>
                            </div>
                            <div>
                                <button class="btn btn-warning btn-sm" onclick="toggleAdminStatus('${uid}', ${adminData.active})" 
                                        style="padding: 8px 15px; font-size: 12px;">
                                    ${adminData.active ? 'üö´ –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' : '‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å'}
                                </button>
                                <button class="btn btn-danger btn-sm" onclick="deleteAdmin('${uid}', '${adminData.email}')" 
                                        style="padding: 8px 15px; font-size: 12px; margin-top: 5px;">
                                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                adminList.innerHTML = html;
                log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${Object.keys(admins).length} –∞–¥–º–∏–Ω–æ–≤`, 'success');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∞–¥–º–∏–Ω–∞
        async function toggleAdminStatus(uid, currentStatus) {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ ${currentStatus ? '–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å' : '–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å'} —ç—Ç–æ–≥–æ –∞–¥–º–∏–Ω–∞?`)) {
                return;
            }
            
            try {
                await database.ref(`admins/${uid}/active`).set(!currentStatus);
                log(`‚úÖ –°—Ç–∞—Ç—É—Å –∞–¥–º–∏–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω: ${currentStatus ? '–î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω' : '–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω'}`, 'success');
                await loadAdmins();
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: ${error.message}`, 'error');
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞
        async function deleteAdmin(uid, email) {
            if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∞–¥–º–∏–Ω–∞ ${email}?\n–≠—Ç–æ —É–¥–∞–ª–∏—Ç –µ–≥–æ –∏–∑ —Å–ø–∏—Å–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –Ω–æ –Ω–µ –∏–∑ Firebase Authentication.`)) {
                return;
            }
            
            try {
                await database.ref(`admins/${uid}`).remove();
                log(`‚úÖ –ê–¥–º–∏–Ω ${email} —É–¥–∞–ª–µ–Ω –∏–∑ —Å–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è`, 'success');
                await loadAdmins();
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–æ–≤
        async function exportAdmins() {
            try {
                const snapshot = await database.ref('admins').once('value');
                const admins = snapshot.val();
                
                if (!admins) {
                    log('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'warning');
                    return;
                }
                
                const data = Object.entries(admins).map(([uid, admin]) => ({
                    uid: uid,
                    email: admin.email,
                    displayName: admin.displayName,
                    level: admin.level,
                    active: admin.active,
                    updatedAt: admin.updatedAt
                }));
                
                const jsonString = JSON.stringify(data, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `jojoland_admins_${Date.now()}.json`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                log(`üì• –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${data.length} –∑–∞–ø–∏—Å–µ–π`, 'success');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${error.message}`, 'error');
            }
        }
        
        // –¢–µ—Å—Ç –≤—Ö–æ–¥–∞
        async function testLogin() {
            const email = document.getElementById('test-email').value.trim();
            const password = document.getElementById('test-password').value;
            
            if (!email || !password) {
                log('–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è —Ç–µ—Å—Ç–∞', 'error');
                return;
            }
            
            try {
                log(`üîê –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤—Ö–æ–¥ –¥–ª—è ${email}...`, 'info');
                
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                log(`‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.email}`, 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∞–¥–º–∏–Ω–æ–º
                const adminSnapshot = await database.ref(`admins/${user.uid}`).once('value');
                if (adminSnapshot.exists()) {
                    const adminData = adminSnapshot.val();
                    log(`üéØ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–æ–º: ${adminData.displayName} (–£—Ä–æ–≤–µ–Ω—å: ${getLevelName(adminData.level)})`, 'success');
                    
                    if (adminData.active) {
                        log(`‚úÖ –°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–µ–Ω`, 'success');
                    } else {
                        log(`‚ö†Ô∏è –°—Ç–∞—Ç—É—Å: –ù–µ–∞–∫—Ç–∏–≤–µ–Ω (–¥–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω)`, 'warning');
                    }
                } else {
                    log(`‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–ø–∏—Å–∫–µ –∞–¥–º–∏–Ω–æ–≤`, 'error');
                }
                
                // –í—ã—Ö–æ–¥–∏–º
                await auth.signOut();
                log('üö™ –í—ã–ø–æ–ª–Ω–µ–Ω –≤—ã—Ö–æ–¥ –∏–∑ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞', 'info');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ${getErrorMessage(error)}`, 'error');
            }
        }
        
        // –¢–µ—Å—Ç –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
        async function testAdminPanel() {
            const email = document.getElementById('test-email').value.trim();
            const password = document.getElementById('test-password').value;
            
            if (!email || !password) {
                log('–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è —Ç–µ—Å—Ç–∞ –ø–∞–Ω–µ–ª–∏', 'error');
                return;
            }
            
            try {
                log(`üé∞ –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏...`, 'info');
                
                // –ü—Ä–æ–±—É–µ–º –≤–æ–π—Ç–∏
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞
                const adminSnapshot = await database.ref(`admins/${user.uid}`).once('value');
                
                if (adminSnapshot.exists()) {
                    const adminData = adminSnapshot.val();
                    
                    if (adminData.active) {
                        log(`‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω! –ê–¥–º–∏–Ω ${email} –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å`, 'success');
                        log(`üìä –£—Ä–æ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–∞: ${getLevelName(adminData.level)}`, 'info');
                        
                        // –û—Ç–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
                        setTimeout(() => {
                            window.open('admin-casino.html', '_blank');
                        }, 1000);
                        
                    } else {
                        log(`‚ùå –ê–¥–º–∏–Ω –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω. –î–æ—Å—Ç—É–ø –∫ –ø–∞–Ω–µ–ª–∏ –∑–∞–ø—Ä–µ—â–µ–Ω.`, 'error');
                    }
                } else {
                    log(`‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–æ–º. –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω.`, 'error');
                }
                
                // –í—ã—Ö–æ–¥–∏–º
                await auth.signOut();
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞: ${getErrorMessage(error)}`, 'error');
            }
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getLevelName(level) {
            const levels = {
                'super_admin': 'üëë –°—É–ø–µ—Ä-–∞–¥–º–∏–Ω',
                'admin': 'üîß –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                'moderator': 'üëÅÔ∏è –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä'
            };
            return levels[level] || level;
        }
        
        function getErrorMessage(error) {
            const errorMessages = {
                'auth/email-already-in-use': 'Email —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º',
                'auth/invalid-email': '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email',
                'auth/operation-not-allowed': '–û–ø–µ—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∞',
                'auth/weak-password': '–°–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å (–º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤)',
                'auth/user-disabled': '–ê–∫–∫–∞—É–Ω—Ç –æ—Ç–∫–ª—é—á–µ–Ω',
                'auth/user-not-found': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω',
                'auth/wrong-password': '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å',
                'auth/too-many-requests': '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ'
            };
            
            return errorMessages[error.code] || error.message;
        }
        
        function resetForm() {
            document.getElementById('admin-email').value = '';
            document.getElementById('admin-password').value = '';
            document.getElementById('admin-display-name').value = '';
            document.getElementById('admin-level').value = 'super_admin';
            log('üîÑ –§–æ—Ä–º–∞ –æ—á–∏—â–µ–Ω–∞', 'info');
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –∫–Ω–æ–ø–æ–∫
        const style = document.createElement('style');
        style.textContent = `
            .btn-sm {
                padding: 6px 12px !important;
                font-size: 12px !important;
                margin: 2px !important;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
