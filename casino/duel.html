<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î—É—ç–ª—å | –ö–∞–∑–∏–Ω–æ JojoLand</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="casino.css">
    <link rel="stylesheet" href="game.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Michroma&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

<div id="loader">
    <div class="spinner"></div>
    <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
</div>

<div class="background-effects" id="particles"></div>

<div id="content">
    <header>
        <div class="header-top">
            <a href="casino.html" class="profile-btn">
                <span class="profile-icon">üé∞</span>
                <span class="profile-text">–í –∫–∞–∑–∏–Ω–æ</span>
            </a>
            <a href="index.html" class="profile-btn">
                <span class="profile-icon">üè†</span>
                <span class="profile-text">–ù–∞ –≥–ª–∞–≤–Ω—É—é</span>
            </a>
            <img src="images/logo.png" class="logo" alt="JojoLand Logo">
        </div>
        
        <h1>‚öîÔ∏è –î—É—ç–ª—å</h1>
        <p class="subtitle">–°—Ä–∞–∑–∏—Ç–µ—Å—å —Å –¥—Ä—É–≥–∏–º –∏–≥—Ä–æ–∫–æ–º 1 –Ω–∞ 1</p>
    </header>

    <div class="game-container">
        <!-- –ò–ù–§–û –ò–ì–†–´ -->
        <div class="game-info-section">
            <div class="game-rules">
                <h2>‚öîÔ∏è –ü—Ä–∞–≤–∏–ª–∞ –¥—É—ç–ª–∏</h2>
                <ul>
                    <li>–°–æ–∑–¥–∞–π—Ç–µ –∏–≥—Ä—É –∏–ª–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π</li>
                    <li>–°—Ç–∞–≤–∫–∞ –æ—Ç 10 –¥–æ 1000 –Ω–æ–≤–æ–≥–æ–¥–Ω–∏—Ö –æ—á–∫–æ–≤</li>
                    <li>–ö–æ–≥–¥–∞ —Å–æ–±–µ—Ä—É—Ç—Å—è 2 –∏–≥—Ä–æ–∫–∞, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –¥—É—ç–ª—å</li>
                    <li>–®–∞–Ω—Å –Ω–∞ –ø–æ–±–µ–¥—É –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞: 50%</li>
                    <li>–ü–æ–±–µ–¥–∏—Ç–µ–ª—å –∑–∞–±–∏—Ä–∞–µ—Ç —Å—Ç–∞–≤–∫—É –ø—Ä–æ–∏–≥—Ä–∞–≤—à–µ–≥–æ</li>
                    <li>–ò–≥—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º</li>
                </ul>
            </div>
            
            <div class="game-balance">
                <div class="balance-card">
                    <div class="balance-icon">üí∞</div>
                    <div class="balance-info">
                        <h3>–í–∞—à –±–∞–ª–∞–Ω—Å</h3>
                        <div class="balance-amount" id="user-balance">0</div>
                        <p class="balance-label">–Ω–æ–≤–æ–≥–æ–¥–Ω–∏—Ö –æ—á–∫–æ–≤</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°–û–ó–î–ê–ù–ò–ï –ò–ì–†–´ -->
        <div class="create-game-section">
            <h2>üéÆ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –¥—É—ç–ª—å</h2>
            
            <div class="bet-section">
                <div class="bet-input">
                    <label for="duel-bet">–°—Ç–∞–≤–∫–∞ (–æ—á–∫–æ–≤):</label>
                    <div class="input-group">
                        <input type="number" id="duel-bet" min="10" max="1000" value="100">
                        <span class="input-suffix">–æ—á–∫–æ–≤</span>
                    </div>
                    <div class="bet-buttons">
                        <button class="quick-bet" data-amount="10">10</button>
                        <button class="quick-bet" data-amount="50">50</button>
                        <button class="quick-bet" data-amount="100">100</button>
                        <button class="quick-bet" data-amount="500">500</button>
                        <button class="quick-bet" data-amount="1000">1000</button>
                    </div>
                </div>
                
                <div class="game-info">
                    <div class="info-card">
                        <div class="info-icon">üé≤</div>
                        <div class="info-content">
                            <h4>–í–æ–∑–º–æ–∂–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à</h4>
                            <div class="win-amount" id="possible-win">200</div>
                            <p>–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ x2</p>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <div class="info-icon">üë•</div>
                        <div class="info-content">
                            <h4>–ò–≥—Ä–æ–∫–æ–≤</h4>
                            <div class="players-count">2</div>
                            <p>–ù—É–∂–µ–Ω 1 —Å–æ–ø–µ—Ä–Ω–∏–∫</p>
                        </div>
                    </div>
                </div>
                
                <button class="create-btn" id="create-duel-btn">
                    ‚öîÔ∏è –°–æ–∑–¥–∞—Ç—å –¥—É—ç–ª—å
                </button>
            </div>
        </div>

        <!-- –ê–ö–¢–ò–í–ù–´–ï –î–£–≠–õ–ò -->
        <div class="active-duels-section">
            <h2>üî• –ê–∫—Ç–∏–≤–Ω—ã–µ –¥—É—ç–ª–∏</h2>
            <p class="section-subtitle">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –¥—É—ç–ª—è–º –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤</p>
            
            <div class="active-games-list" id="active-duels">
                <!-- –î—É—ç–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥—É—ç–ª–µ–π...</p>
                </div>
            </div>
            
            <div class="refresh-btn-container">
                <button class="refresh-btn" id="refresh-duels">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
            </div>
        </div>

        <!-- –í–ê–®–ò –î–£–≠–õ–ò -->
        <div class="my-duels-section">
            <h2>üìã –í–∞—à–∏ –¥—É—ç–ª–∏</h2>
            
            <div class="duels-tabs">
                <button class="duel-tab active" data-status="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</button>
                <button class="duel-tab" data-status="finished">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ</button>
            </div>
            
            <div class="my-duels-list" id="my-duels">
                <!-- –î—É—ç–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>

        <!-- –ö–ù–û–ü–ö–ò -->
        <div class="action-buttons">
            <button class="action-btn" id="back-btn">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</button>
            <button class="action-btn" id="join-random-btn">üé≤ –ë—ã—Å—Ç—Ä–∞—è –∏–≥—Ä–∞</button>
        </div>
    </div>
</div>

<!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–£–≠–õ–ò -->
<div id="duel-modal" class="modal-overlay">
    <div class="modal-content duel-modal">
        <div class="duel-header">
            <h2>‚öîÔ∏è –î—É—ç–ª—å</h2>
            <p id="duel-status">–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...</p>
        </div>
        
        <div class="duel-body">
            <div class="duel-info">
                <div class="info-item">
                    <span class="info-label">–°—Ç–∞–≤–∫–∞:</span>
                    <span class="info-value" id="modal-duel-bet">100</span>
                </div>
                <div class="info-item">
                    <span class="info-label">–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à:</span>
                    <span class="info-value" id="modal-potential-win">200</span>
                </div>
            </div>
            
            <div class="duel-players">
                <div class="player-card" id="player1">
                    <div class="player-avatar">üë§</div>
                    <div class="player-info">
                        <div class="player-name" id="player1-name">–í—ã</div>
                        <div class="player-status ready">–ì–æ—Ç–æ–≤</div>
                    </div>
                </div>
                
                <div class="vs-text">VS</div>
                
                <div class="player-card" id="player2">
                    <div class="player-avatar">‚ùì</div>
                    <div class="player-info">
                        <div class="player-name">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
                        <div class="player-status waiting">–û–∂–∏–¥–∞–Ω–∏–µ</div>
                    </div>
                </div>
            </div>
            
            <div class="duel-timer" id="duel-timer">
                <div class="timer-bar">
                    <div class="timer-fill"></div>
                </div>
                <div class="timer-text">–î–æ –Ω–∞—á–∞–ª–∞: <span id="timer-countdown">30</span>—Å</div>
            </div>
            
            <div class="duel-result" id="duel-result" style="display: none;">
                <div class="result-title" id="result-title">–ü–æ–±–µ–¥–∏—Ç–µ–ª—å!</div>
                <div class="winner-player" id="winner-player">
                    <div class="winner-avatar">üëë</div>
                    <div class="winner-name">–ò–≥—Ä–æ–∫</div>
                </div>
                <div class="result-message" id="result-message"></div>
                <div class="result-amount" id="result-amount"></div>
            </div>
        </div>
        
        <div class="duel-footer">
            <button class="close-btn" id="close-duel">–í—ã–π—Ç–∏</button>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
const firebaseConfig = {
    apiKey: "AIzaSyBwhNixWO8dF_drN2hHVYzfTAbMCiT91Gw",
    authDomain: "jojoland-chat.firebasestorage.app",
    databaseURL: "https://jojoland-chat-default-rtdb.firebaseio.com",
    projectId: "jojoland-chat",
    storageBucket: "jojoland-chat.firebasestorage.app",
    messagingSenderId: "602788305122",
    appId: "1:602788305122:web:c03f5b5ef59c85fc9fe6bb"
};

if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}
const database = firebase.database();

let userId = null;
let userNickname = null;
let userBalance = 0;
let currentDuelId = null;
let currentBet = 100;

window.onload = async function() {
    if (await checkAuth()) {
        await loadUserBalance();
        setupEventListeners();
        loadActiveDuels();
        loadMyDuels();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–≥—Ä—ã –≤ URL
        const urlParams = new URLSearchParams(window.location.search);
        const gameId = urlParams.get('game');
        if (gameId) {
            await joinExistingDuel(gameId);
        }
    }
};

async function checkAuth() {
    userId = localStorage.getItem('jojoland_userId');
    userNickname = localStorage.getItem('jojoland_nickname');
    
    if (!userId || !userNickname) {
        alert('–î–ª—è –∏–≥—Ä—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç');
        window.location.href = 'index.html';
        return false;
    }
    return true;
}

async function loadUserBalance() {
    try {
        const snapshot = await database.ref('holiday_points/' + userId).once('value');
        if (snapshot.exists()) {
            const pointsData = snapshot.val();
            userBalance = pointsData.available_points || 0;
            document.getElementById('user-balance').textContent = userBalance;
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–ª–∞–Ω—Å–∞:', error);
    }
}

function setupEventListeners() {
    // –°—Ç–∞–≤–∫–∞
    const betInput = document.getElementById('duel-bet');
    
    betInput.addEventListener('input', function() {
        let value = parseInt(this.value) || 10;
        value = Math.min(Math.max(value, 10), 1000);
        currentBet = value;
        this.value = value;
        updatePossibleWin();
    });
    
    // –ë—ã—Å—Ç—Ä—ã–µ —Å—Ç–∞–≤–∫–∏
    document.querySelectorAll('.quick-bet').forEach(btn => {
        btn.addEventListener('click', function() {
            currentBet = parseInt(this.getAttribute('data-amount'));
            betInput.value = currentBet;
            updatePossibleWin();
        });
    });
    
    // –ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥—É—ç–ª–∏
    document.getElementById('create-duel-btn').addEventListener('click', createDuel);
    
    // –ö–Ω–æ–ø–∫–∞ –±—ã—Å—Ç—Ä–æ–π –∏–≥—Ä—ã
    document.getElementById('join-random-btn').addEventListener('click', joinRandomDuel);
    
    // –ö–Ω–æ–ø–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –¥—É—ç–ª–µ–π
    document.getElementById('refresh-duels').addEventListener('click', loadActiveDuels);
    
    // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
    document.getElementById('back-btn').addEventListener('click', function() {
        window.location.href = 'casino.html';
    });
    
    // –í–∫–ª–∞–¥–∫–∏ –º–æ–∏—Ö –¥—É—ç–ª–µ–π
    document.querySelectorAll('.duel-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('.duel-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            loadMyDuels(this.getAttribute('data-status'));
        });
    });
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    document.getElementById('close-duel').addEventListener('click', function() {
        document.getElementById('duel-modal').style.display = 'none';
        if (currentDuelId) {
            leaveDuel();
        }
    });
}

function updatePossibleWin() {
    const winAmount = currentBet * 2;
    document.getElementById('possible-win').textContent = winAmount;
}

async function createDuel() {
    if (currentBet < 10 || currentBet > userBalance) {
        showError(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤. –ù—É–∂–Ω–æ: ${currentBet}, —É –≤–∞—Å: ${userBalance}`);
        return;
    }
    
    try {
        // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
        const pointsSnapshot = await database.ref('holiday_points/' + userId).once('value');
        if (pointsSnapshot.exists()) {
            const pointsData = pointsSnapshot.val();
            const newBalance = (pointsData.available_points || 0) - currentBet;
            
            await database.ref('holiday_points/' + userId).update({
                available_points: newBalance
            });
            
            userBalance = newBalance;
            document.getElementById('user-balance').textContent = userBalance;
        }
        
        // –°–æ–∑–¥–∞–µ–º –¥—É—ç–ª—å
        const duelId = 'duel_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        currentDuelId = duelId;
        
        const duelData = {
            game_type: 'duel',
            created_by: userId,
            creator_nickname: userNickname,
            bet: currentBet,
            created_at: new Date().toISOString(),
            status: 'waiting',
            max_players: 2,
            players: {
                [userId]: {
                    nickname: userNickname,
                    joined_at: new Date().toISOString(),
                    result: null
                }
            },
            winner: null,
            finished_at: null
        };
        
        await database.ref('casino_games/' + duelId).set(duelData);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥—É—ç–ª–∏
        showDuelModal(duelData);
        
        // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥—É—ç–ª–∏
        setupDuelListener(duelId);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥—É—ç–ª–∏:', error);
        showError('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥—É—ç–ª–∏');
    }
}

async function loadActiveDuels() {
    try {
        const duelsList = document.getElementById('active-duels');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        duelsList.innerHTML = `
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥—É—ç–ª–µ–π...</p>
            </div>
        `;
        
        // –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –¥—É—ç–ª–∏
        const snapshot = await database.ref('casino_games').orderByChild('game_type').equalTo('duel').once('value');
        
        if (!snapshot.exists()) {
            duelsList.innerHTML = `
                <div class="empty-games">
                    <div class="empty-icon">‚öîÔ∏è</div>
                    <p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥—É—ç–ª–µ–π</p>
                    <small>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –¥—É—ç–ª—å!</small>
                </div>
            `;
            return;
        }
        
        const duelsData = snapshot.val();
        const activeDuels = [];
        
        // –§–∏–ª—å—Ç—Ä—É–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –¥—É—ç–ª–∏
        for (const duelId in duelsData) {
            const duel = duelsData[duelId];
            
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –¥—É—ç–ª–∏
            if (duel.status === 'finished' || duel.status === 'cancelled') {
                continue;
            }
            
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –¥—É—ç–ª–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
            if (duel.created_by === userId) {
                continue;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            const players = duel.players || {};
            if (players[userId]) {
                continue;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤
            if (Object.keys(players).length >= duel.max_players) {
                continue;
            }
            
            activeDuels.push({
                id: duelId,
                bet: duel.bet,
                creator: duel.creator_nickname,
                creatorId: duel.created_by,
                playersCount: Object.keys(players).length,
                maxPlayers: duel.max_players,
                createdTime: duel.created_at
            });
        }
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
        activeDuels.sort((a, b) => new Date(b.createdTime) - new Date(a.createdTime));
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥—É—ç–ª–∏
        if (activeDuels.length === 0) {
            duelsList.innerHTML = `
                <div class="empty-games">
                    <div class="empty-icon">‚öîÔ∏è</div>
                    <p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥—É—ç–ª–µ–π</p>
                    <small>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –¥—É—ç–ª—å!</small>
                </div>
            `;
        } else {
            duelsList.innerHTML = activeDuels.map(duel => {
                const timeAgo = getTimeAgo(new Date(duel.createdTime));
                
                return `
                    <div class="active-game-card">
                        <div class="game-header">
                            <div class="game-type">
                                <span class="game-icon">‚öîÔ∏è</span>
                                <span class="game-name">–î—É—ç–ª—å</span>
                            </div>
                            <div class="game-time">${timeAgo}</div>
                        </div>
                        <div class="game-info">
                            <div class="game-creator">
                                <span class="info-label">–°–æ–∑–¥–∞—Ç–µ–ª—å:</span>
                                <span class="info-value">${duel.creator}</span>
                            </div>
                            <div class="game-bet">
                                <span class="info-label">–°—Ç–∞–≤–∫–∞:</span>
                                <span class="info-value">${duel.bet} –æ—á–∫–æ–≤</span>
                            </div>
                            <div class="game-players">
                                <span class="info-label">–ò–≥—Ä–æ–∫–æ–≤:</span>
                                <span class="info-value">${duel.playersCount}/${duel.maxPlayers}</span>
                            </div>
                        </div>
                        <button class="join-btn" onclick="joinDuel('${duel.id}')">
                            –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è
                        </button>
                    </div>
                `;
            }).join('');
        }
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥—É—ç–ª–µ–π:', error);
        document.getElementById('active-duels').innerHTML = `
            <div style="color: #ff4444; text-align: center;">
                <div style="font-size: 40px; margin-bottom: 10px;">‚ö†Ô∏è</div>
                <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥—É—ç–ª–µ–π</p>
            </div>
        `;
    }
}

async function joinDuel(duelId) {
    try {
        const duelSnapshot = await database.ref('casino_games/' + duelId).once('value');
        
        if (!duelSnapshot.exists()) {
            showError('–î—É—ç–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            return;
        }
        
        const duel = duelSnapshot.val();
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –¥—É—ç–ª–∏
        if (duel.status !== 'waiting') {
            showError('–î—É—ç–ª—å —É–∂–µ –Ω–∞—á–∞–ª–∞—Å—å –∏–ª–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤
        const players = duel.players || {};
        if (Object.keys(players).length >= duel.max_players) {
            showError('–î—É—ç–ª—å —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞');
            return;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–ª–∞–Ω—Å
        if (userBalance < duel.bet) {
            showError(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤. –ù—É–∂–Ω–æ: ${duel.bet}, —É –≤–∞—Å: ${userBalance}`);
            return;
        }
        
        // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
        const pointsSnapshot = await database.ref('holiday_points/' + userId).once('value');
        if (pointsSnapshot.exists()) {
            const pointsData = pointsSnapshot.val();
            const newBalance = (pointsData.available_points || 0) - duel.bet;
            
            await database.ref('holiday_points/' + userId).update({
                available_points: newBalance
            });
            
            userBalance = newBalance;
            document.getElementById('user-balance').textContent = userBalance;
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∏–≥—Ä–æ–∫–∞ –≤ –¥—É—ç–ª—å
        players[userId] = {
            nickname: userNickname,
            joined_at: new Date().toISOString(),
            result: null
        };
        
        await database.ref('casino_games/' + duelId).update({
            players: players
        });
        
        currentDuelId = duelId;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥—É—ç–ª–∏
        showDuelModal(duel);
        
        // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥—É—ç–ª–∏
        setupDuelListener(duelId);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –¥—É—ç–ª–∏:', error);
        showError('–û—à–∏–±–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –¥—É—ç–ª–∏');
    }
}

async function joinRandomDuel() {
    try {
        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –¥—É—ç–ª–∏
        const snapshot = await database.ref('casino_games').orderByChild('game_type').equalTo('duel').once('value');
        
        if (!snapshot.exists()) {
            showError('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥—É—ç–ª–µ–π');
            return;
        }
        
        const duelsData = snapshot.val();
        const availableDuels = [];
        
        // –ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –¥—É—ç–ª–∏
        for (const duelId in duelsData) {
            const duel = duelsData[duelId];
            
            if (duel.status !== 'waiting') continue;
            if (duel.created_by === userId) continue;
            
            const players = duel.players || {};
            if (players[userId]) continue;
            if (Object.keys(players).length >= duel.max_players) continue;
            
            if (userBalance >= duel.bet) {
                availableDuels.push({
                    id: duelId,
                    bet: duel.bet,
                    ...duel
                });
            }
        }
        
        if (availableDuels.length === 0) {
            showError('–ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –¥—É—ç–ª–µ–π');
            return;
        }
        
        // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é –¥—É—ç–ª—å
        const randomDuel = availableDuels[Math.floor(Math.random() * availableDuels.length)];
        await joinDuel(randomDuel.id);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Å–ª—É—á–∞–π–Ω–æ–π –¥—É—ç–ª–∏:', error);
        showError('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –¥—É—ç–ª–∏');
    }
}

async function joinExistingDuel(duelId) {
    try {
        const duelSnapshot = await database.ref('casino_games/' + duelId).once('value');
        
        if (!duelSnapshot.exists()) {
            showError('–î—É—ç–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            return;
        }
        
        const duel = duelSnapshot.val();
        currentDuelId = duelId;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        showDuelModal(duel);
        
        // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        setupDuelListener(duelId);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥—É—ç–ª–∏:', error);
        showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥—É—ç–ª–∏');
    }
}

function showDuelModal(duelData) {
    const modal = document.getElementById('duel-modal');
    document.getElementById('modal-duel-bet').textContent = duelData.bet;
    document.getElementById('modal-potential-win').textContent = duelData.bet * 2;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≥—Ä–æ–∫–∞—Ö
    updatePlayersInfo(duelData.players);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –µ—Å–ª–∏ –µ—Å—Ç—å –≤—Ç–æ—Ä–æ–π –∏–≥—Ä–æ–∫
    const playersCount = Object.keys(duelData.players || {}).length;
    if (playersCount >= 2) {
        startDuelTimer(duelData);
    }
    
    modal.style.display = 'flex';
}

function updatePlayersInfo(players) {
    const playerIds = Object.keys(players || {});
    
    // –ò–≥—Ä–æ–∫ 1 (—Å–æ–∑–¥–∞—Ç–µ–ª—å –∏–ª–∏ –ø–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫)
    if (playerIds.length > 0) {
        const player1Id = playerIds[0];
        const player1 = players[player1Id];
        document.getElementById('player1-name').textContent = player1.nickname;
    }
    
    // –ò–≥—Ä–æ–∫ 2 (–≤—Ç–æ—Ä–æ–π –∏–≥—Ä–æ–∫ –∏–ª–∏ –æ–∂–∏–¥–∞–Ω–∏–µ)
    if (playerIds.length > 1) {
        const player2Id = playerIds[1];
        const player2 = players[player2Id];
        document.getElementById('player2').querySelector('.player-avatar').textContent = 'üë§';
        document.getElementById('player2').querySelector('.player-name').textContent = player2.nickname;
        document.getElementById('player2').querySelector('.player-status').textContent = '–ì–æ—Ç–æ–≤';
        document.getElementById('player2').querySelector('.player-status').className = 'player-status ready';
    }
}

function startDuelTimer(duelData) {
    const timerBar = document.querySelector('.timer-fill');
    const timerText = document.getElementById('timer-countdown');
    let timeLeft = 30;
    
    const timer = setInterval(() => {
        timeLeft--;
        timerText.textContent = timeLeft;
        timerBar.style.width = `${(timeLeft / 30) * 100}%`;
        
        if (timeLeft <= 0) {
            clearInterval(timer);
            startDuel(duelData);
        }
    }, 1000);
}

async function startDuel(duelData) {
    try {
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –¥—É—ç–ª–∏
        await database.ref('casino_games/' + currentDuelId).update({
            status: 'in_progress',
            started_at: new Date().toISOString()
        });
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º (50/50)
        const players = Object.keys(duelData.players || {});
        const winnerIndex = Math.floor(Math.random() * players.length);
        const winnerId = players[winnerIndex];
        const loserId = players.find(id => id !== winnerId);
        
        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à (—Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–∏–≥—Ä–∞–≤—à–µ–≥–æ)
        const winAmount = duelData.bet;
        
        // –ù–∞—á–∏—Å–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à –ø–æ–±–µ–¥–∏—Ç–µ–ª—é
        const winnerSnapshot = await database.ref('holiday_points/' + winnerId).once('value');
        if (winnerSnapshot.exists()) {
            const winnerData = winnerSnapshot.val();
            const newBalance = (winnerData.available_points || 0) + winAmount * 2; // +—Å—Ç–∞–≤–∫–∞ –ø—Ä–æ–∏–≥—Ä–∞–≤—à–µ–≥–æ + —Å–≤–æ—è —Å—Ç–∞–≤–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ
            
            await database.ref('holiday_points/' + winnerId).update({
                available_points: newBalance
            });
        }
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        const updatedPlayers = duelData.players;
        updatedPlayers[winnerId].result = 'win';
        updatedPlayers[loserId].result = 'lose';
        
        await database.ref('casino_games/' + currentDuelId).update({
            status: 'finished',
            finished_at: new Date().toISOString(),
            winner: winnerId,
            players: updatedPlayers
        });
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        showDuelResult(winnerId, winAmount);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è –æ–±–æ–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
        await saveDuelHistory(duelData, winnerId, loserId, winAmount);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –¥—É—ç–ª–∏:', error);
    }
}

function showDuelResult(winnerId, winAmount) {
    const resultDiv = document.getElementById('duel-result');
    const title = document.getElementById('result-title');
    const winnerPlayer = document.getElementById('winner-player');
    const message = document.getElementById('result-message');
    const amount = document.getElementById('result-amount');
    
    resultDiv.style.display = 'block';
    
    if (winnerId === userId) {
        title.textContent = 'üéâ –í—ã –ø–æ–±–µ–¥–∏–ª–∏!';
        message.textContent = '–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –¥—É—ç–ª—å!';
        amount.textContent = `+${winAmount * 2} –æ—á–∫–æ–≤`;
        amount.style.color = '#00ff00';
    } else {
        title.textContent = 'üíÄ –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏';
        message.textContent = '–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏ –¥—É—ç–ª—å';
        amount.textContent = `-${winAmount} –æ—á–∫–æ–≤`;
        amount.style.color = '#ff4444';
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∞–≤–∞—Ç–∞—Ä –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
    winnerPlayer.querySelector('.winner-name').textContent = 
        winnerId === userId ? userNickname : '–°–æ–ø–µ—Ä–Ω–∏–∫';
}

async function saveDuelHistory(duelData, winnerId, loserId, winAmount) {
    const timestamp = new Date().toISOString();
    
    // –î–ª—è –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
    const winnerHistory = {
        game_type: 'duel',
        bet: duelData.bet,
        opponent: loserId,
        result: 'win',
        win_amount: winAmount * 2,
        timestamp: timestamp
    };
    
    await database.ref('casino_history/' + winnerId + '/' + currentDuelId).set(winnerHistory);
    
    // –î–ª—è –ø—Ä–æ–∏–≥—Ä–∞–≤—à–µ–≥–æ
    const loserHistory = {
        game_type: 'duel',
        bet: duelData.bet,
        opponent: winnerId,
        result: 'lose',
        win_amount: 0,
        timestamp: timestamp
    };
    
    await database.ref('casino_history/' + loserId + '/' + currentDuelId).set(loserHistory);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (winnerId === userId || loserId === userId) {
        await loadUserBalance();
        loadMyDuels();
    }
}

async function loadMyDuels(status = 'active') {
    try {
        const myDuelsList = document.getElementById('my-duels');
        
        // –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏–≥—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const historySnapshot = await database.ref('casino_history/' + userId).once('value');
        
        if (!historySnapshot.exists()) {
            myDuelsList.innerHTML = `
                <div class="empty-duels">
                    <div class="empty-icon">üì≠</div>
                    <p>–ù–µ—Ç ${status === 'active' ? '–∞–∫—Ç–∏–≤–Ω—ã—Ö' : '–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö'} –¥—É—ç–ª–µ–π</p>
                </div>
            `;
            return;
        }
        
        const historyData = historySnapshot.val();
        const myDuels = [];
        
        // –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–æ–ª—å–∫–æ –¥—É—ç–ª–∏
        for (const gameId in historyData) {
            const game = historyData[gameId];
            
            if (game.game_type !== 'duel') continue;
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ —Å—Ç–∞—Ç—É—Å—É
            const isFinished = game.result === 'win' || game.result === 'lose';
            
            if (status === 'active' && isFinished) continue;
            if (status === 'finished' && !isFinished) continue;
            
            myDuels.push({
                id: gameId,
                ...game
            });
        }
        
        // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
        myDuels.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥—É—ç–ª–∏
        if (myDuels.length === 0) {
            myDuelsList.innerHTML = `
                <div class="empty-duels">
                    <div class="empty-icon">üì≠</div>
                    <p>–ù–µ—Ç ${status === 'active' ? '–∞–∫—Ç–∏–≤–Ω—ã—Ö' : '–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö'} –¥—É—ç–ª–µ–π</p>
                </div>
            `;
        } else {
            myDuelsList.innerHTML = myDuels.map(duel => {
                const date = new Date(duel.timestamp);
                const formattedDate = date.toLocaleDateString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                let resultClass = '';
                let resultIcon = '';
                let resultText = '';
                
                if (duel.result === 'win') {
                    resultClass = 'win';
                    resultIcon = 'üí∞';
                    resultText = '–ü–æ–±–µ–¥–∞';
                } else if (duel.result === 'lose') {
                    resultClass = 'lose';
                    resultIcon = 'üí∏';
                    resultText = '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ';
                } else {
                    resultClass = 'active';
                    resultIcon = '‚è≥';
                    resultText = '–í –ø—Ä–æ—Ü–µ—Å—Å–µ';
                }
                
                return `
                    <div class="my-duel-card ${resultClass}">
                        <div class="duel-info">
                            <div class="duel-result-icon">${resultIcon}</div>
                            <div class="duel-details">
                                <div class="duel-bet">–°—Ç–∞–≤–∫–∞: <strong>${duel.bet}</strong> –æ—á–∫–æ–≤</div>
                                <div class="duel-time">${formattedDate}</div>
                            </div>
                        </div>
                        <div class="duel-status">
                            <div class="status-text">${resultText}</div>
                            <div class="status-amount ${duel.result}">
                                ${duel.result === 'win' ? '+' : duel.result === 'lose' ? '-' : ''}
                                ${duel.result === 'win' ? duel.win_amount : duel.bet} –æ—á–∫–æ–≤
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥—É—ç–ª–µ–π:', error);
        myDuelsList.innerHTML = `
            <div style="color: #ff4444; text-align: center;">
                <div style="font-size: 40px; margin-bottom: 10px;">‚ö†Ô∏è</div>
                <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥—É—ç–ª–µ–π</p>
            </div>
        `;
    }
}

function setupDuelListener(duelId) {
    database.ref('casino_games/' + duelId).on('value', async (snapshot) => {
        if (!snapshot.exists()) {
            // –î—É—ç–ª—å –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞
            document.getElementById('duel-modal').style.display = 'none';
            currentDuelId = null;
            return;
        }
        
        const duel = snapshot.val();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≥—Ä–æ–∫–∞—Ö
        updatePlayersInfo(duel.players);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
        const statusElement = document.getElementById('duel-status');
        if (duel.status === 'waiting') {
            statusElement.textContent = '–û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞...';
        } else if (duel.status === 'in_progress') {
            statusElement.textContent = '–î—É—ç–ª—å –Ω–∞—á–∞–ª–∞—Å—å!';
        } else if (duel.status === 'finished') {
            statusElement.textContent = '–î—É—ç–ª—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –µ—Å–ª–∏ –µ—â–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏
            if (!document.getElementById('duel-result').style.display || 
                document.getElementById('duel-result').style.display === 'none') {
                
                const playerData = duel.players[userId];
                if (playerData && playerData.result) {
                    showDuelResult(
                        duel.winner, 
                        duel.bet
                    );
                }
            }
        }
    });
}

async function leaveDuel() {
    if (!currentDuelId) return;
    
    try {
        const duelRef = database.ref('casino_games/' + currentDuelId);
        const snapshot = await duelRef.once('value');
        const duel = snapshot.val();
        
        // –ï—Å–ª–∏ –¥—É—ç–ª—å –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–≤–∫—É
        if (duel.status === 'waiting') {
            const pointsSnapshot = await database.ref('holiday_points/' + userId).once('value');
            if (pointsSnapshot.exists()) {
                const pointsData = pointsSnapshot.val();
                const newBalance = (pointsData.available_points || 0) + currentBet;
                
                await database.ref('holiday_points/' + userId).update({
                    available_points: newBalance
                });
                
                userBalance = newBalance;
                document.getElementById('user-balance').textContent = userBalance;
            }
            
            // –£–¥–∞–ª—è–µ–º –∏–≥—Ä–æ–∫–∞ –∏–∑ –¥—É—ç–ª–∏
            delete duel.players[userId];
            await duelRef.update({ players: duel.players });
            
            // –ï—Å–ª–∏ –∏–≥—Ä–æ–∫–æ–≤ –Ω–µ –æ—Å—Ç–∞–ª–æ—Å—å, —É–¥–∞–ª—è–µ–º –¥—É—ç–ª—å
            if (Object.keys(duel.players).length === 0) {
                await duelRef.remove();
            }
        }
        
        currentDuelId = null;
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ –¥—É—ç–ª–∏:', error);
    }
}

function getTimeAgo(date) {
    const now = new Date();
    const diff = Math.floor((now - date) / 1000);
    
    if (diff < 60) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
    else if (diff < 3600) {
        const minutes = Math.floor(diff / 60);
        return `${minutes} –º–∏–Ω –Ω–∞–∑–∞–¥`;
    } else if (diff < 86400) {
        const hours = Math.floor(diff / 3600);
        return `${hours} —á –Ω–∞–∑–∞–¥`;
    } else {
        const days = Math.floor(diff / 86400);
        return `${days} –¥–Ω –Ω–∞–∑–∞–¥`;
    }
}

function showError(message) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'notification error';
    errorDiv.textContent = message;
    
    document.body.appendChild(errorDiv);
    
    setTimeout(() => {
        errorDiv.remove();
    }, 3000);
}
</script>

</body>
</html>
